{"ast":null,"code":"var _jsxFileName = \"/Users/chenguanyu/Desktop/yuniver_CRUD/client/src/pages/FlowChartEditor.jsx\",\n  _s = $RefreshSig$();\n// src/pages/CustomFlowChartEditor.jsx\nimport React, { useState, useEffect, useRef } from 'react';\nimport axios from 'axios';\nimport { useParams } from 'react-router-dom';\n\n// 節點預設尺寸\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst DEFAULT_NODE_WIDTH = 140;\nconst DEFAULT_NODE_HEIGHT = 80;\nconst PHASE_DEFAULT_WIDTH = 300;\nconst PHASE_DEFAULT_HEIGHT = 200;\nconst RESIZE_HANDLE_SIZE = 10;\nconst PHASE_PADDING = 20;\nconst getNodeDimensions = node => {\n  // 若節點已有 width/height，回傳；否則依 type 給定預設值\n  if (node.width && node.height) return {\n    width: node.width,\n    height: node.height\n  };\n  if (node.type === 'phase') return {\n    width: PHASE_DEFAULT_WIDTH,\n    height: PHASE_DEFAULT_HEIGHT\n  };\n  return {\n    width: DEFAULT_NODE_WIDTH,\n    height: DEFAULT_NODE_HEIGHT\n  };\n};\n\n// 根據 type 產生節點內容與樣式\nconst renderNodeContent = node => {\n  const commonStyle = {\n    padding: \"4px\",\n    textAlign: \"center\",\n    fontSize: \"12px\",\n    width: \"100%\",\n    height: \"100%\"\n  };\n  switch (node.type) {\n    case \"phase\":\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          ...commonStyle,\n          border: \"2px dashed blue\",\n          backgroundColor: \"#e0f7ff\",\n          overflow: \"hidden\"\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            fontWeight: \"bold\",\n            fontSize: \"14px\"\n          },\n          children: node.label\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 33,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: node.description\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 34,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 27,\n        columnNumber: 9\n      }, this);\n    case \"task\":\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          ...commonStyle,\n          border: \"2px solid black\",\n          backgroundColor: \"#fff\"\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            fontWeight: \"bold\"\n          },\n          children: node.label\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 44,\n          columnNumber: 11\n        }, this), node.important && /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            color: \"red\"\n          },\n          children: \"Important\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 45,\n          columnNumber: 30\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: node.description\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 46,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 39,\n        columnNumber: 9\n      }, this);\n    case \"subFlow\":\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          ...commonStyle,\n          border: \"2px solid gray\",\n          backgroundColor: \"#f0f0f0\"\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            fontWeight: \"bold\"\n          },\n          children: node.label\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 56,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: node.description\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 57,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 51,\n        columnNumber: 9\n      }, this);\n    case \"iterative\":\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          ...commonStyle,\n          border: \"2px dotted green\",\n          backgroundColor: \"#e8ffe8\"\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            fontWeight: \"bold\"\n          },\n          children: [node.label, \" \\uD83D\\uDD04\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 67,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: node.description\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 68,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 62,\n        columnNumber: 9\n      }, this);\n    case \"note\":\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          ...commonStyle,\n          border: \"1px solid orange\",\n          backgroundColor: \"#fff7d6\"\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            fontStyle: \"italic\"\n          },\n          children: node.text || node.label\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 78,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: node.description\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 79,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 73,\n        columnNumber: 9\n      }, this);\n    case \"extra\":\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          ...commonStyle,\n          fontSize: \"10px\"\n        },\n        children: [\"\\u2022 \", node.content]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 84,\n        columnNumber: 9\n      }, this);\n    default:\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          ...commonStyle,\n          border: \"1px solid black\"\n        },\n        children: node.label || \"No Label\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 90,\n        columnNumber: 9\n      }, this);\n  }\n};\n\n// 計算 phase 節點顯示尺寸：自動包住其子節點\nconst computePhaseDisplayDimensions = (phase, allNodes) => {\n  if (!phase.children || phase.children.length === 0) return getNodeDimensions(phase);\n  // 找出所有屬於該 phase 的子節點\n  const childrenNodes = allNodes.filter(n => phase.children.includes(n.id));\n  if (childrenNodes.length === 0) return getNodeDimensions(phase);\n  let minX = Infinity,\n    minY = Infinity,\n    maxX = -Infinity,\n    maxY = -Infinity;\n  childrenNodes.forEach(child => {\n    const dims = getNodeDimensions(child);\n    minX = Math.min(minX, child.position.x);\n    minY = Math.min(minY, child.position.y);\n    maxX = Math.max(maxX, child.position.x + dims.width);\n    maxY = Math.max(maxY, child.position.y + dims.height);\n  });\n  // 讓 phase 的左上角保持原位置，或調整為能包住子節點\n  const newWidth = Math.max(PHASE_DEFAULT_WIDTH, maxX - phase.position.x + PHASE_PADDING);\n  const newHeight = Math.max(PHASE_DEFAULT_HEIGHT, maxY - phase.position.y + PHASE_PADDING);\n  return {\n    width: newWidth,\n    height: newHeight\n  };\n};\nconst CustomFlowChartEditor = () => {\n  _s();\n  const {\n    id: projectId\n  } = useParams();\n  const token = localStorage.getItem('token');\n  const API_URL = process.env.REACT_APP_API_URL || 'http://localhost:5001/api';\n  const containerRef = useRef(null);\n\n  // 節點狀態，每個節點包含 id, type, label, description, extras, link, children, position, width, height\n  const [nodes, setNodes] = useState([]);\n  // 被選中節點 id\n  const [selectedNodeId, setSelectedNodeId] = useState(null);\n  // 拖曳狀態\n  const [draggingNodeId, setDraggingNodeId] = useState(null);\n  const [dragOffset, setDragOffset] = useState({\n    x: 0,\n    y: 0\n  });\n  // 調整大小狀態\n  const [resizingNodeId, setResizingNodeId] = useState(null);\n  const [resizeStart, setResizeStart] = useState({\n    mouseX: 0,\n    mouseY: 0,\n    width: 0,\n    height: 0\n  });\n\n  // 讀取後端流程圖資料\n  useEffect(() => {\n    const fetchFlowChart = async () => {\n      try {\n        const res = await axios.get(`${API_URL}/projects/${projectId}/flowchart`, {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        });\n        setNodes(res.data || []);\n      } catch (error) {\n        console.error(\"Failed to load flowchart:\", error);\n      }\n    };\n    fetchFlowChart();\n  }, [projectId, API_URL, token]);\n\n  // 拖曳節點：記錄拖曳起始點與偏移量\n  const handleMouseDown = (e, nodeId) => {\n    e.stopPropagation();\n    // 若點擊的是 resize handle，則不處理拖曳\n    if (e.target.dataset.resize === \"true\") return;\n    const nodeElem = e.currentTarget;\n    const rect = nodeElem.getBoundingClientRect();\n    setDraggingNodeId(nodeId);\n    setDragOffset({\n      x: e.clientX - rect.left,\n      y: e.clientY - rect.top\n    });\n  };\n\n  // 拖曳過程中更新節點位置\n  const handleMouseMove = e => {\n    // 調整大小優先處理\n    if (resizingNodeId) {\n      const deltaX = e.clientX - resizeStart.mouseX;\n      const deltaY = e.clientY - resizeStart.mouseY;\n      setNodes(prevNodes => prevNodes.map(n => n.id === resizingNodeId ? {\n        ...n,\n        width: Math.max(50, resizeStart.width + deltaX),\n        height: Math.max(30, resizeStart.height + deltaY)\n      } : n));\n      return;\n    }\n    if (!draggingNodeId) return;\n    const containerRect = containerRef.current.getBoundingClientRect();\n    const newX = e.clientX - containerRect.left - dragOffset.x;\n    const newY = e.clientY - containerRect.top - dragOffset.y;\n    setNodes(prevNodes => prevNodes.map(n => {\n      if (n.id === draggingNodeId) {\n        // 如果拖曳的是 phase，移動 phase同時移動其子節點\n        const deltaX = newX - n.position.x;\n        const deltaY = newY - n.position.y;\n        if (n.type === 'phase' && n.children && n.children.length > 0) {\n          return {\n            ...n,\n            position: {\n              x: newX,\n              y: newY\n            }\n          };\n        }\n        return {\n          ...n,\n          position: {\n            x: newX,\n            y: newY\n          }\n        };\n      }\n      // 若此節點是被某個 phase拖動時的子節點（且非獨立拖曳），更新其位置\n      // 可進一步實作：若拖曳 phase時自動更新所有屬於該 phase的子節點\n      return n;\n    }));\n  };\n  const handleMouseUp = () => {\n    setDraggingNodeId(null);\n    setResizingNodeId(null);\n  };\n\n  // 點選節點以供編輯\n  const handleSelectNode = (e, nodeId) => {\n    e.stopPropagation();\n    setSelectedNodeId(nodeId);\n  };\n\n  // 刪除節點，同時從所有父節點的 children 刪除\n  const handleDeleteNode = nodeId => {\n    setNodes(prevNodes => prevNodes.filter(n => n.id !== nodeId).map(n => n.children ? {\n      ...n,\n      children: n.children.filter(childId => childId !== nodeId)\n    } : n));\n    if (selectedNodeId === nodeId) setSelectedNodeId(null);\n  };\n\n  // 調整大小：開始拖動 resize handle\n  const handleResizeMouseDown = (e, nodeId) => {\n    e.stopPropagation();\n    setResizingNodeId(nodeId);\n    setResizeStart({\n      mouseX: e.clientX,\n      mouseY: e.clientY,\n      width: getNodeDimensions(nodes.find(n => n.id === nodeId)).width,\n      height: getNodeDimensions(nodes.find(n => n.id === nodeId)).height\n    });\n  };\n\n  // 側邊編輯表單更新節點屬性（直接屬性）\n  const handleEditChange = e => {\n    if (!selectedNodeId) return;\n    const {\n      name,\n      value\n    } = e.target;\n    setNodes(prevNodes => prevNodes.map(n => n.id === selectedNodeId ? {\n      ...n,\n      [name]: value\n    } : n));\n  };\n\n  // 特別處理 children 屬性（以逗號分隔轉為陣列）\n  const handleChildrenChange = e => {\n    if (!selectedNodeId) return;\n    const children = e.target.value.split(\",\").map(s => s.trim()).filter(s => s);\n    setNodes(prevNodes => prevNodes.map(n => n.id === selectedNodeId ? {\n      ...n,\n      children\n    } : n));\n  };\n\n  // 新增節點\n  const handleAddNode = () => {\n    const newNode = {\n      id: `${Date.now()}`,\n      type: \"task\",\n      // 預設 type 為 task\n      label: \"New Node\",\n      description: \"\",\n      extras: [],\n      link: \"\",\n      children: [],\n      position: {\n        x: 50,\n        y: 50\n      },\n      width: DEFAULT_NODE_WIDTH,\n      height: DEFAULT_NODE_HEIGHT\n    };\n    setNodes(prev => [...prev, newNode]);\n  };\n\n  // 計算 phase 節點自動包住子節點的顯示尺寸\n  const getPhaseDisplayDimensions = phase => {\n    const base = getNodeDimensions(phase);\n    if (!phase.children || phase.children.length === 0) return base;\n    const childrenNodes = nodes.filter(n => phase.children.includes(n.id));\n    if (childrenNodes.length === 0) return base;\n    let minX = Infinity,\n      minY = Infinity,\n      maxX = -Infinity,\n      maxY = -Infinity;\n    childrenNodes.forEach(child => {\n      const dims = getNodeDimensions(child);\n      minX = Math.min(minX, child.position.x);\n      minY = Math.min(minY, child.position.y);\n      maxX = Math.max(maxX, child.position.x + dims.width);\n      maxY = Math.max(maxY, child.position.y + dims.height);\n    });\n    // phase 左上角不變，寬高調整為能包住所有子節點，加上些許 padding\n    return {\n      width: Math.max(base.width, maxX - phase.position.x + PHASE_PADDING),\n      height: Math.max(base.height, maxY - phase.position.y + PHASE_PADDING)\n    };\n  };\n\n  // 儲存流程圖到後端\n  const handleSave = async () => {\n    try {\n      await axios.put(`${API_URL}/projects/${projectId}/flowchart`, {\n        flowChart: nodes\n      }, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n      alert(\"Flowchart saved successfully!\");\n    } catch (error) {\n      console.error(\"Failed to save flowchart:\", error);\n      alert(\"Save failed.\");\n    }\n  };\n\n  // 渲染連線：根據每個節點的 children，從父節點中心連線到子節點中心\n  const renderConnections = () => {\n    const lines = [];\n    nodes.forEach(parent => {\n      if (parent.children && Array.isArray(parent.children)) {\n        parent.children.forEach(childId => {\n          const child = nodes.find(n => n.id === childId);\n          if (child) {\n            const parentDims = parent.type === 'phase' ? getPhaseDisplayDimensions(parent) : getNodeDimensions(parent);\n            const childDims = getNodeDimensions(child);\n            const startX = parent.position.x + parentDims.width / 2;\n            const startY = parent.position.y + parentDims.height / 2;\n            const endX = child.position.x + childDims.width / 2;\n            const endY = child.position.y + childDims.height / 2;\n            lines.push(/*#__PURE__*/_jsxDEV(\"line\", {\n              x1: startX,\n              y1: startY,\n              x2: endX,\n              y2: endY,\n              stroke: \"black\",\n              strokeWidth: \"2\"\n            }, `line-${parent.id}-${child.id}`, false, {\n              fileName: _jsxFileName,\n              lineNumber: 319,\n              columnNumber: 15\n            }, this));\n          }\n        });\n      }\n    });\n    return lines;\n  };\n  const selectedNode = nodes.find(n => n.id === selectedNodeId);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: \"Custom Flow Chart Editor\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 336,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        marginBottom: \"10px\"\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: handleAddNode,\n        children: \"Add Node\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 338,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: handleSave,\n        style: {\n          marginLeft: \"10px\"\n        },\n        children: \"Save Flow Chart\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 339,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 337,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      ref: containerRef,\n      style: {\n        position: \"relative\",\n        width: \"100%\",\n        height: \"600px\",\n        border: \"1px solid #ccc\"\n      },\n      onMouseMove: handleMouseMove,\n      onMouseUp: handleMouseUp,\n      children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n        style: {\n          position: \"absolute\",\n          top: 0,\n          left: 0,\n          width: \"100%\",\n          height: \"100%\"\n        },\n        children: renderConnections()\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 347,\n        columnNumber: 9\n      }, this), nodes.map(node => {\n        // 如果是 phase，動態計算顯示尺寸\n        const dims = node.type === 'phase' ? getPhaseDisplayDimensions(node) : getNodeDimensions(node);\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            position: \"absolute\",\n            left: node.position.x,\n            top: node.position.y,\n            width: dims.width,\n            height: dims.height,\n            boxSizing: \"border-box\",\n            border: selectedNodeId === node.id ? \"2px solid blue\" : \"none\",\n            backgroundColor: \"transparent\",\n            cursor: \"move\"\n          },\n          onMouseDown: e => handleMouseDown(e, node.id),\n          onClick: e => handleSelectNode(e, node.id),\n          children: [renderNodeContent(node), /*#__PURE__*/_jsxDEV(\"button\", {\n            style: {\n              position: \"absolute\",\n              top: 0,\n              right: 0,\n              backgroundColor: \"red\",\n              color: \"#fff\",\n              border: \"none\",\n              cursor: \"pointer\",\n              fontSize: \"10px\",\n              padding: \"2px\"\n            },\n            onClick: e => {\n              e.stopPropagation();\n              handleDeleteNode(node.id);\n            },\n            children: \"X\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 372,\n            columnNumber: 15\n          }, this), selectedNodeId === node.id && /*#__PURE__*/_jsxDEV(\"div\", {\n            \"data-resize\": \"true\",\n            style: {\n              position: \"absolute\",\n              right: 0,\n              bottom: 0,\n              width: RESIZE_HANDLE_SIZE,\n              height: RESIZE_HANDLE_SIZE,\n              backgroundColor: \"gray\",\n              cursor: \"nwse-resize\"\n            },\n            onMouseDown: e => handleResizeMouseDown(e, node.id)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 393,\n            columnNumber: 17\n          }, this)]\n        }, node.id, true, {\n          fileName: _jsxFileName,\n          lineNumber: 354,\n          columnNumber: 13\n        }, this);\n      })]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 341,\n      columnNumber: 7\n    }, this), selectedNode && /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        marginTop: \"20px\",\n        border: \"1px solid #ccc\",\n        padding: \"10px\"\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n        children: \"Edit Node Properties\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 414,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          children: \"Type:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 416,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n          name: \"type\",\n          value: selectedNode.type,\n          onChange: handleEditChange,\n          children: [/*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"phase\",\n            children: \"phase\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 418,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"task\",\n            children: \"task\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 419,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"subFlow\",\n            children: \"subFlow\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 420,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"iterative\",\n            children: \"iterative\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 421,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"note\",\n            children: \"note\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 422,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"extra\",\n            children: \"extra\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 423,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 417,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 415,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          children: \"Label:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 427,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          name: \"label\",\n          value: selectedNode.label,\n          onChange: handleEditChange\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 428,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 426,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          children: \"Description:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 431,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n          name: \"description\",\n          value: selectedNode.description,\n          onChange: handleEditChange\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 432,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 430,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          children: \"Link:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 435,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          name: \"link\",\n          value: selectedNode.link,\n          onChange: handleEditChange\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 436,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 434,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          children: \"Children (comma-separated IDs):\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 439,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          value: (selectedNode.children || []).join(\",\"),\n          onChange: handleChildrenChange\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 440,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 438,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          children: \"Extras (comma-separated):\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 446,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          name: \"extras\",\n          value: (selectedNode.extras || []).join(\",\"),\n          onChange: e => {\n            const arr = e.target.value.split(\",\").map(s => s.trim()).filter(s => s);\n            handleEditChange({\n              target: {\n                name: \"extras\",\n                value: arr\n              }\n            });\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 447,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 445,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 413,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 335,\n    columnNumber: 5\n  }, this);\n};\n_s(CustomFlowChartEditor, \"4Am2hIzbskjJuofkojn4yCYePMk=\", false, function () {\n  return [useParams];\n});\n_c = CustomFlowChartEditor;\nexport default CustomFlowChartEditor;\nvar _c;\n$RefreshReg$(_c, \"CustomFlowChartEditor\");","map":{"version":3,"names":["React","useState","useEffect","useRef","axios","useParams","jsxDEV","_jsxDEV","DEFAULT_NODE_WIDTH","DEFAULT_NODE_HEIGHT","PHASE_DEFAULT_WIDTH","PHASE_DEFAULT_HEIGHT","RESIZE_HANDLE_SIZE","PHASE_PADDING","getNodeDimensions","node","width","height","type","renderNodeContent","commonStyle","padding","textAlign","fontSize","style","border","backgroundColor","overflow","children","fontWeight","label","fileName","_jsxFileName","lineNumber","columnNumber","description","important","color","fontStyle","text","content","computePhaseDisplayDimensions","phase","allNodes","length","childrenNodes","filter","n","includes","id","minX","Infinity","minY","maxX","maxY","forEach","child","dims","Math","min","position","x","y","max","newWidth","newHeight","CustomFlowChartEditor","_s","projectId","token","localStorage","getItem","API_URL","process","env","REACT_APP_API_URL","containerRef","nodes","setNodes","selectedNodeId","setSelectedNodeId","draggingNodeId","setDraggingNodeId","dragOffset","setDragOffset","resizingNodeId","setResizingNodeId","resizeStart","setResizeStart","mouseX","mouseY","fetchFlowChart","res","get","headers","Authorization","data","error","console","handleMouseDown","e","nodeId","stopPropagation","target","dataset","resize","nodeElem","currentTarget","rect","getBoundingClientRect","clientX","left","clientY","top","handleMouseMove","deltaX","deltaY","prevNodes","map","containerRect","current","newX","newY","handleMouseUp","handleSelectNode","handleDeleteNode","childId","handleResizeMouseDown","find","handleEditChange","name","value","handleChildrenChange","split","s","trim","handleAddNode","newNode","Date","now","extras","link","prev","getPhaseDisplayDimensions","base","handleSave","put","flowChart","alert","renderConnections","lines","parent","Array","isArray","parentDims","childDims","startX","startY","endX","endY","push","x1","y1","x2","y2","stroke","strokeWidth","selectedNode","marginBottom","onClick","marginLeft","ref","onMouseMove","onMouseUp","boxSizing","cursor","onMouseDown","right","bottom","marginTop","onChange","join","arr","_c","$RefreshReg$"],"sources":["/Users/chenguanyu/Desktop/yuniver_CRUD/client/src/pages/FlowChartEditor.jsx"],"sourcesContent":["// src/pages/CustomFlowChartEditor.jsx\nimport React, { useState, useEffect, useRef } from 'react';\nimport axios from 'axios';\nimport { useParams } from 'react-router-dom';\n\n// 節點預設尺寸\nconst DEFAULT_NODE_WIDTH = 140;\nconst DEFAULT_NODE_HEIGHT = 80;\nconst PHASE_DEFAULT_WIDTH = 300;\nconst PHASE_DEFAULT_HEIGHT = 200;\nconst RESIZE_HANDLE_SIZE = 10;\nconst PHASE_PADDING = 20;\n\nconst getNodeDimensions = (node) => {\n  // 若節點已有 width/height，回傳；否則依 type 給定預設值\n  if (node.width && node.height) return { width: node.width, height: node.height };\n  if (node.type === 'phase') return { width: PHASE_DEFAULT_WIDTH, height: PHASE_DEFAULT_HEIGHT };\n  return { width: DEFAULT_NODE_WIDTH, height: DEFAULT_NODE_HEIGHT };\n};\n\n// 根據 type 產生節點內容與樣式\nconst renderNodeContent = (node) => {\n  const commonStyle = { padding: \"4px\", textAlign: \"center\", fontSize: \"12px\", width: \"100%\", height: \"100%\" };\n  switch (node.type) {\n    case \"phase\":\n      return (\n        <div style={{\n          ...commonStyle,\n          border: \"2px dashed blue\",\n          backgroundColor: \"#e0f7ff\",\n          overflow: \"hidden\"\n        }}>\n          <div style={{ fontWeight: \"bold\", fontSize: \"14px\" }}>{node.label}</div>\n          <div>{node.description}</div>\n        </div>\n      );\n    case \"task\":\n      return (\n        <div style={{\n          ...commonStyle,\n          border: \"2px solid black\",\n          backgroundColor: \"#fff\"\n        }}>\n          <div style={{ fontWeight: \"bold\" }}>{node.label}</div>\n          {node.important && <div style={{ color: \"red\" }}>Important</div>}\n          <div>{node.description}</div>\n        </div>\n      );\n    case \"subFlow\":\n      return (\n        <div style={{\n          ...commonStyle,\n          border: \"2px solid gray\",\n          backgroundColor: \"#f0f0f0\"\n        }}>\n          <div style={{ fontWeight: \"bold\" }}>{node.label}</div>\n          <div>{node.description}</div>\n        </div>\n      );\n    case \"iterative\":\n      return (\n        <div style={{\n          ...commonStyle,\n          border: \"2px dotted green\",\n          backgroundColor: \"#e8ffe8\"\n        }}>\n          <div style={{ fontWeight: \"bold\" }}>{node.label} 🔄</div>\n          <div>{node.description}</div>\n        </div>\n      );\n    case \"note\":\n      return (\n        <div style={{\n          ...commonStyle,\n          border: \"1px solid orange\",\n          backgroundColor: \"#fff7d6\"\n        }}>\n          <div style={{ fontStyle: \"italic\" }}>{node.text || node.label}</div>\n          <div>{node.description}</div>\n        </div>\n      );\n    case \"extra\":\n      return (\n        <div style={{ ...commonStyle, fontSize:\"10px\" }}>\n          • {node.content}\n        </div>\n      );\n    default:\n      return (\n        <div style={{ ...commonStyle, border: \"1px solid black\" }}>\n          {node.label || \"No Label\"}\n        </div>\n      );\n  }\n};\n\n// 計算 phase 節點顯示尺寸：自動包住其子節點\nconst computePhaseDisplayDimensions = (phase, allNodes) => {\n  if (!phase.children || phase.children.length === 0) return getNodeDimensions(phase);\n  // 找出所有屬於該 phase 的子節點\n  const childrenNodes = allNodes.filter(n => phase.children.includes(n.id));\n  if (childrenNodes.length === 0) return getNodeDimensions(phase);\n  let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;\n  childrenNodes.forEach(child => {\n    const dims = getNodeDimensions(child);\n    minX = Math.min(minX, child.position.x);\n    minY = Math.min(minY, child.position.y);\n    maxX = Math.max(maxX, child.position.x + dims.width);\n    maxY = Math.max(maxY, child.position.y + dims.height);\n  });\n  // 讓 phase 的左上角保持原位置，或調整為能包住子節點\n  const newWidth = Math.max(PHASE_DEFAULT_WIDTH, maxX - phase.position.x + PHASE_PADDING);\n  const newHeight = Math.max(PHASE_DEFAULT_HEIGHT, maxY - phase.position.y + PHASE_PADDING);\n  return { width: newWidth, height: newHeight };\n};\n\nconst CustomFlowChartEditor = () => {\n  const { id: projectId } = useParams();\n  const token = localStorage.getItem('token');\n  const API_URL = process.env.REACT_APP_API_URL || 'http://localhost:5001/api';\n  const containerRef = useRef(null);\n\n  // 節點狀態，每個節點包含 id, type, label, description, extras, link, children, position, width, height\n  const [nodes, setNodes] = useState([]);\n  // 被選中節點 id\n  const [selectedNodeId, setSelectedNodeId] = useState(null);\n  // 拖曳狀態\n  const [draggingNodeId, setDraggingNodeId] = useState(null);\n  const [dragOffset, setDragOffset] = useState({ x: 0, y: 0 });\n  // 調整大小狀態\n  const [resizingNodeId, setResizingNodeId] = useState(null);\n  const [resizeStart, setResizeStart] = useState({ mouseX: 0, mouseY: 0, width: 0, height: 0 });\n\n  // 讀取後端流程圖資料\n  useEffect(() => {\n    const fetchFlowChart = async () => {\n      try {\n        const res = await axios.get(`${API_URL}/projects/${projectId}/flowchart`, {\n          headers: { Authorization: `Bearer ${token}` },\n        });\n        setNodes(res.data || []);\n      } catch (error) {\n        console.error(\"Failed to load flowchart:\", error);\n      }\n    };\n    fetchFlowChart();\n  }, [projectId, API_URL, token]);\n\n  // 拖曳節點：記錄拖曳起始點與偏移量\n  const handleMouseDown = (e, nodeId) => {\n    e.stopPropagation();\n    // 若點擊的是 resize handle，則不處理拖曳\n    if (e.target.dataset.resize === \"true\") return;\n    const nodeElem = e.currentTarget;\n    const rect = nodeElem.getBoundingClientRect();\n    setDraggingNodeId(nodeId);\n    setDragOffset({ x: e.clientX - rect.left, y: e.clientY - rect.top });\n  };\n\n  // 拖曳過程中更新節點位置\n  const handleMouseMove = (e) => {\n    // 調整大小優先處理\n    if (resizingNodeId) {\n      const deltaX = e.clientX - resizeStart.mouseX;\n      const deltaY = e.clientY - resizeStart.mouseY;\n      setNodes(prevNodes =>\n        prevNodes.map(n =>\n          n.id === resizingNodeId ? { \n            ...n, \n            width: Math.max(50, resizeStart.width + deltaX),\n            height: Math.max(30, resizeStart.height + deltaY)\n          } : n\n        )\n      );\n      return;\n    }\n    if (!draggingNodeId) return;\n    const containerRect = containerRef.current.getBoundingClientRect();\n    const newX = e.clientX - containerRect.left - dragOffset.x;\n    const newY = e.clientY - containerRect.top - dragOffset.y;\n    setNodes(prevNodes =>\n      prevNodes.map(n => {\n        if (n.id === draggingNodeId) {\n          // 如果拖曳的是 phase，移動 phase同時移動其子節點\n          const deltaX = newX - n.position.x;\n          const deltaY = newY - n.position.y;\n          if (n.type === 'phase' && n.children && n.children.length > 0) {\n            return { ...n, position: { x: newX, y: newY } };\n          }\n          return { ...n, position: { x: newX, y: newY } };\n        }\n        // 若此節點是被某個 phase拖動時的子節點（且非獨立拖曳），更新其位置\n        // 可進一步實作：若拖曳 phase時自動更新所有屬於該 phase的子節點\n        return n;\n      })\n    );\n  };\n\n  const handleMouseUp = () => {\n    setDraggingNodeId(null);\n    setResizingNodeId(null);\n  };\n\n  // 點選節點以供編輯\n  const handleSelectNode = (e, nodeId) => {\n    e.stopPropagation();\n    setSelectedNodeId(nodeId);\n  };\n\n  // 刪除節點，同時從所有父節點的 children 刪除\n  const handleDeleteNode = (nodeId) => {\n    setNodes(prevNodes =>\n      prevNodes\n        .filter(n => n.id !== nodeId)\n        .map(n => n.children ? { ...n, children: n.children.filter(childId => childId !== nodeId) } : n)\n    );\n    if (selectedNodeId === nodeId) setSelectedNodeId(null);\n  };\n\n  // 調整大小：開始拖動 resize handle\n  const handleResizeMouseDown = (e, nodeId) => {\n    e.stopPropagation();\n    setResizingNodeId(nodeId);\n    setResizeStart({\n      mouseX: e.clientX,\n      mouseY: e.clientY,\n      width: getNodeDimensions(nodes.find(n => n.id === nodeId)).width,\n      height: getNodeDimensions(nodes.find(n => n.id === nodeId)).height\n    });\n  };\n\n  // 側邊編輯表單更新節點屬性（直接屬性）\n  const handleEditChange = (e) => {\n    if (!selectedNodeId) return;\n    const { name, value } = e.target;\n    setNodes(prevNodes =>\n      prevNodes.map(n =>\n        n.id === selectedNodeId ? { ...n, [name]: value } : n\n      )\n    );\n  };\n\n  // 特別處理 children 屬性（以逗號分隔轉為陣列）\n  const handleChildrenChange = (e) => {\n    if (!selectedNodeId) return;\n    const children = e.target.value.split(\",\").map(s => s.trim()).filter(s => s);\n    setNodes(prevNodes =>\n      prevNodes.map(n =>\n        n.id === selectedNodeId ? { ...n, children } : n\n      )\n    );\n  };\n\n  // 新增節點\n  const handleAddNode = () => {\n    const newNode = {\n      id: `${Date.now()}`,\n      type: \"task\",  // 預設 type 為 task\n      label: \"New Node\",\n      description: \"\",\n      extras: [],\n      link: \"\",\n      children: [],\n      position: { x: 50, y: 50 },\n      width: DEFAULT_NODE_WIDTH,\n      height: DEFAULT_NODE_HEIGHT\n    };\n    setNodes(prev => [...prev, newNode]);\n  };\n\n  // 計算 phase 節點自動包住子節點的顯示尺寸\n  const getPhaseDisplayDimensions = (phase) => {\n    const base = getNodeDimensions(phase);\n    if (!phase.children || phase.children.length === 0) return base;\n    const childrenNodes = nodes.filter(n => phase.children.includes(n.id));\n    if (childrenNodes.length === 0) return base;\n    let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;\n    childrenNodes.forEach(child => {\n      const dims = getNodeDimensions(child);\n      minX = Math.min(minX, child.position.x);\n      minY = Math.min(minY, child.position.y);\n      maxX = Math.max(maxX, child.position.x + dims.width);\n      maxY = Math.max(maxY, child.position.y + dims.height);\n    });\n    // phase 左上角不變，寬高調整為能包住所有子節點，加上些許 padding\n    return { width: Math.max(base.width, maxX - phase.position.x + PHASE_PADDING),\n             height: Math.max(base.height, maxY - phase.position.y + PHASE_PADDING) };\n  };\n\n  // 儲存流程圖到後端\n  const handleSave = async () => {\n    try {\n      await axios.put(`${API_URL}/projects/${projectId}/flowchart`,\n        { flowChart: nodes },\n        { headers: { Authorization: `Bearer ${token}` } }\n      );\n      alert(\"Flowchart saved successfully!\");\n    } catch (error) {\n      console.error(\"Failed to save flowchart:\", error);\n      alert(\"Save failed.\");\n    }\n  };\n\n  // 渲染連線：根據每個節點的 children，從父節點中心連線到子節點中心\n  const renderConnections = () => {\n    const lines = [];\n    nodes.forEach(parent => {\n      if (parent.children && Array.isArray(parent.children)) {\n        parent.children.forEach(childId => {\n          const child = nodes.find(n => n.id === childId);\n          if (child) {\n            const parentDims = parent.type === 'phase' ? getPhaseDisplayDimensions(parent) : getNodeDimensions(parent);\n            const childDims = getNodeDimensions(child);\n            const startX = parent.position.x + parentDims.width / 2;\n            const startY = parent.position.y + parentDims.height / 2;\n            const endX = child.position.x + childDims.width / 2;\n            const endY = child.position.y + childDims.height / 2;\n            lines.push(\n              <line\n                key={`line-${parent.id}-${child.id}`}\n                x1={startX} y1={startY} x2={endX} y2={endY}\n                stroke=\"black\" strokeWidth=\"2\"\n              />\n            );\n          }\n        });\n      }\n    });\n    return lines;\n  };\n\n  const selectedNode = nodes.find(n => n.id === selectedNodeId);\n\n  return (\n    <div>\n      <h2>Custom Flow Chart Editor</h2>\n      <div style={{ marginBottom: \"10px\" }}>\n        <button onClick={handleAddNode}>Add Node</button>\n        <button onClick={handleSave} style={{ marginLeft: \"10px\" }}>Save Flow Chart</button>\n      </div>\n      <div\n        ref={containerRef}\n        style={{ position: \"relative\", width: \"100%\", height: \"600px\", border: \"1px solid #ccc\" }}\n        onMouseMove={handleMouseMove}\n        onMouseUp={handleMouseUp}\n      >\n        <svg style={{ position: \"absolute\", top: 0, left: 0, width: \"100%\", height: \"100%\" }}>\n          {renderConnections()}\n        </svg>\n        {nodes.map(node => {\n          // 如果是 phase，動態計算顯示尺寸\n          const dims = node.type === 'phase' ? getPhaseDisplayDimensions(node) : getNodeDimensions(node);\n          return (\n            <div\n              key={node.id}\n              style={{\n                position: \"absolute\",\n                left: node.position.x,\n                top: node.position.y,\n                width: dims.width,\n                height: dims.height,\n                boxSizing: \"border-box\",\n                border: selectedNodeId === node.id ? \"2px solid blue\" : \"none\",\n                backgroundColor: \"transparent\",\n                cursor: \"move\"\n              }}\n              onMouseDown={(e) => handleMouseDown(e, node.id)}\n              onClick={(e) => handleSelectNode(e, node.id)}\n            >\n              {renderNodeContent(node)}\n              {/* 刪除按鈕 */}\n              <button\n                style={{\n                  position: \"absolute\",\n                  top: 0,\n                  right: 0,\n                  backgroundColor: \"red\",\n                  color: \"#fff\",\n                  border: \"none\",\n                  cursor: \"pointer\",\n                  fontSize: \"10px\",\n                  padding: \"2px\"\n                }}\n                onClick={(e) => {\n                  e.stopPropagation();\n                  handleDeleteNode(node.id);\n                }}\n              >\n                X\n              </button>\n              {/* 若此節點為被選中，加入 resize handle */}\n              {selectedNodeId === node.id && (\n                <div\n                  data-resize=\"true\"\n                  style={{\n                    position: \"absolute\",\n                    right: 0,\n                    bottom: 0,\n                    width: RESIZE_HANDLE_SIZE,\n                    height: RESIZE_HANDLE_SIZE,\n                    backgroundColor: \"gray\",\n                    cursor: \"nwse-resize\"\n                  }}\n                  onMouseDown={(e) => handleResizeMouseDown(e, node.id)}\n                />\n              )}\n            </div>\n          );\n        })}\n      </div>\n      {/* 側邊編輯表單 */}\n      {selectedNode && (\n        <div style={{ marginTop: \"20px\", border: \"1px solid #ccc\", padding: \"10px\" }}>\n          <h3>Edit Node Properties</h3>\n          <div>\n            <label>Type:</label>\n            <select name=\"type\" value={selectedNode.type} onChange={handleEditChange}>\n              <option value=\"phase\">phase</option>\n              <option value=\"task\">task</option>\n              <option value=\"subFlow\">subFlow</option>\n              <option value=\"iterative\">iterative</option>\n              <option value=\"note\">note</option>\n              <option value=\"extra\">extra</option>\n            </select>\n          </div>\n          <div>\n            <label>Label:</label>\n            <input name=\"label\" value={selectedNode.label} onChange={handleEditChange} />\n          </div>\n          <div>\n            <label>Description:</label>\n            <textarea name=\"description\" value={selectedNode.description} onChange={handleEditChange} />\n          </div>\n          <div>\n            <label>Link:</label>\n            <input name=\"link\" value={selectedNode.link} onChange={handleEditChange} />\n          </div>\n          <div>\n            <label>Children (comma-separated IDs):</label>\n            <input\n              value={(selectedNode.children || []).join(\",\")}\n              onChange={handleChildrenChange}\n            />\n          </div>\n          <div>\n            <label>Extras (comma-separated):</label>\n            <input\n              name=\"extras\"\n              value={(selectedNode.extras || []).join(\",\")}\n              onChange={(e) => {\n                const arr = e.target.value.split(\",\").map(s => s.trim()).filter(s => s);\n                handleEditChange({ target: { name: \"extras\", value: arr } });\n              }}\n            />\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default CustomFlowChartEditor;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}