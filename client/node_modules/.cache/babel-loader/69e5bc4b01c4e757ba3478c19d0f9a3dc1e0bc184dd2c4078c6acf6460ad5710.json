{"ast":null,"code":"var _jsxFileName = \"/Users/chenguanyu/Desktop/yuniver_CRUD/client/src/pages/FlowChartEditor.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from 'react';\nimport axios from 'axios';\nimport { useParams } from 'react-router-dom';\n\n// 常數設定：預設節點尺寸、容器內邊距\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst DEFAULT_WIDTH = 140;\nconst DEFAULT_HEIGHT = 80;\nconst PHASE_PADDING = 20;\nconst CustomFlowChartEditor = () => {\n  _s();\n  const {\n    id: projectId\n  } = useParams();\n  const token = localStorage.getItem('token');\n  const API_URL = process.env.REACT_APP_API_URL || 'http://localhost:5001/api';\n  const containerRef = useRef(null);\n\n  // 節點資料，每個節點物件包含：id, type, label, description, link, extras, position, width, height, containerId (如果屬於某 Phase)\n  const [nodes, setNodes] = useState([]);\n  // 儲存被選取的節點 id\n  const [selectedNodeId, setSelectedNodeId] = useState(null);\n  // 拖曳狀態：正在拖曳的節點 id及相對偏移量\n  const [dragging, setDragging] = useState({\n    nodeId: null,\n    offset: {\n      x: 0,\n      y: 0\n    }\n  });\n  // 調整大小狀態\n  const [resizing, setResizing] = useState({\n    nodeId: null,\n    startPos: {\n      x: 0,\n      y: 0\n    },\n    startSize: {\n      width: 0,\n      height: 0\n    }\n  });\n\n  // 讀取後端流程圖資料\n  useEffect(() => {\n    const fetchFlowChart = async () => {\n      try {\n        const res = await axios.get(`${API_URL}/projects/${projectId}/flowchart`, {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        });\n        // 預期回傳陣列，每個物件至少有 id, type, label, position, width, height, containerId (可選)\n        setNodes(res.data || []);\n      } catch (error) {\n        console.error(\"Failed to load flowchart:\", error);\n      }\n    };\n    fetchFlowChart();\n  }, [projectId, API_URL, token]);\n\n  // 拖曳開始：記錄拖曳節點和滑鼠偏移量\n  const handleMouseDown = (e, nodeId) => {\n    e.stopPropagation();\n    const nodeElem = e.currentTarget;\n    const rect = nodeElem.getBoundingClientRect();\n    setDragging({\n      nodeId,\n      offset: {\n        x: e.clientX - rect.left,\n        y: e.clientY - rect.top\n      }\n    });\n  };\n\n  // 拖曳中：更新拖曳節點位置（如果是 Phase 且包含子節點，則一起移動）\n  const handleMouseMove = e => {\n    if (!dragging.nodeId) return;\n    const containerRect = containerRef.current.getBoundingClientRect();\n    const newX = e.clientX - containerRect.left - dragging.offset.x;\n    const newY = e.clientY - containerRect.top - dragging.offset.y;\n    setNodes(prev => prev.map(n => {\n      if (n.id === dragging.nodeId) {\n        // 如果是 Phase，計算位移後，同時移動內部節點\n        const deltaX = newX - n.position.x;\n        const deltaY = newY - n.position.y;\n        if (n.type === \"phase\") {\n          // 更新 Phase 節點\n          // 並更新所有屬於此 Phase 的子節點 (containerId === phase id)\n          return n;\n        }\n        return {\n          ...n,\n          position: {\n            x: newX,\n            y: newY\n          }\n        };\n      }\n      // 如果該節點屬於正在拖動的 Phase，移動它\n      if (dragging.nodeId) {\n        const parent = prev.find(p => p.id === dragging.nodeId);\n        if (parent && parent.type === \"phase\" && n.containerId === parent.id) {\n          const deltaX = newX - parent.position.x;\n          const deltaY = newY - parent.position.y;\n          return {\n            ...n,\n            position: {\n              x: n.position.x + deltaX,\n              y: n.position.y + deltaY\n            }\n          };\n        }\n      }\n      return n;\n    }));\n  };\n\n  // 拖曳結束\n  const handleMouseUp = () => {\n    setDragging({\n      nodeId: null,\n      offset: {\n        x: 0,\n        y: 0\n      }\n    });\n  };\n\n  // 節點選取\n  const handleSelectNode = (e, nodeId) => {\n    e.stopPropagation();\n    setSelectedNodeId(nodeId);\n  };\n\n  // 開始調整大小（拖曳右下角）\n  const handleResizeMouseDown = (e, nodeId) => {\n    e.stopPropagation();\n    const node = nodes.find(n => n.id === nodeId);\n    setResizing({\n      nodeId,\n      startPos: {\n        x: e.clientX,\n        y: e.clientY\n      },\n      startSize: {\n        width: node.width,\n        height: node.height\n      }\n    });\n  };\n\n  // 調整大小中\n  const handleResizeMouseMove = e => {\n    if (!resizing.nodeId) return;\n    const deltaX = e.clientX - resizing.startPos.x;\n    const deltaY = e.clientY - resizing.startPos.y;\n    setNodes(prev => prev.map(n => n.id === resizing.nodeId ? {\n      ...n,\n      width: Math.max(50, resizing.startSize.width + deltaX),\n      height: Math.max(30, resizing.startSize.height + deltaY)\n    } : n));\n  };\n\n  // 調整大小結束\n  const handleResizeMouseUp = () => {\n    setResizing({\n      nodeId: null,\n      startPos: {\n        x: 0,\n        y: 0\n      },\n      startSize: {\n        width: 0,\n        height: 0\n      }\n    });\n  };\n\n  // 刪除節點（若是 Phase，這裡只刪除 Phase 本身，不連帶刪除內部節點；可根據需求修改）\n  const handleDeleteNode = () => {\n    if (!selectedNodeId) return;\n    setNodes(prev => prev.filter(n => n.id !== selectedNodeId));\n    setSelectedNodeId(null);\n  };\n\n  // 側邊表單：更新屬性（type, label, description, link, extras, containerId）\n  const handleEditChange = e => {\n    if (!selectedNodeId) return;\n    const {\n      name,\n      value\n    } = e.target;\n    setNodes(prev => prev.map(n => n.id === selectedNodeId ? {\n      ...n,\n      [name]: value\n    } : n));\n  };\n\n  // 更新 containerId（例如手動設定該節點屬於某 Phase）\n  const handleContainerChange = e => {\n    if (!selectedNodeId) return;\n    setNodes(prev => prev.map(n => n.id === selectedNodeId ? {\n      ...n,\n      containerId: e.target.value\n    } : n));\n  };\n\n  // 新增節點\n  const handleAddNode = () => {\n    const newNode = {\n      id: `${Date.now()}`,\n      type: \"task\",\n      label: \"New Node\",\n      description: \"\",\n      extras: [],\n      link: \"\",\n      containerId: \"\",\n      // 空代表不在 Phase 裡\n      position: {\n        x: 50,\n        y: 50\n      },\n      width: DEFAULT_WIDTH,\n      height: DEFAULT_HEIGHT\n    };\n    setNodes(prev => [...prev, newNode]);\n  };\n\n  // 當拖動階段 Phase 時，讓其內部節點也跟著移動\n  const movePhaseChildren = (phaseId, deltaX, deltaY) => {\n    setNodes(prev => prev.map(n => n.containerId === phaseId ? {\n      ...n,\n      position: {\n        x: n.position.x + deltaX,\n        y: n.position.y + deltaY\n      }\n    } : n));\n  };\n\n  // 儲存流程圖資料到後端\n  const handleSave = async () => {\n    try {\n      await axios.put(`${API_URL}/projects/${projectId}/flowchart`, {\n        flowChart: nodes\n      }, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n      alert(\"Flowchart saved successfully!\");\n    } catch (error) {\n      console.error(\"Failed to save flowchart:\", error);\n      alert(\"Save failed.\");\n    }\n  };\n\n  // 計算 Phase 節點的包覆區\n  const computePhaseBounds = phase => {\n    const children = nodes.filter(n => n.containerId === phase.id);\n    if (children.length === 0) return {\n      x: phase.position.x,\n      y: phase.position.y,\n      width: phase.width,\n      height: phase.height\n    };\n    const xs = children.map(n => n.position.x);\n    const ys = children.map(n => n.position.y);\n    const minX = Math.min(...xs) - PHASE_PADDING;\n    const minY = Math.min(...ys) - PHASE_PADDING;\n    const maxX = Math.max(...children.map(n => n.position.x + n.width)) + PHASE_PADDING;\n    const maxY = Math.max(...children.map(n => n.position.y + n.height)) + PHASE_PADDING;\n    return {\n      x: minX,\n      y: minY,\n      width: maxX - minX,\n      height: maxY - minY\n    };\n  };\n\n  // 依據每個節點資料渲染連線（若 node 有 children 陣列存放連線關係，可自行擴充）\n  const renderConnections = () => {\n    // 這裡我們不另外處理 Phase 內的連線\n    return null;\n  };\n\n  // 取得被選取的節點\n  const selectedNode = nodes.find(n => n.id === selectedNodeId);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: \"Custom Flow Chart Editor\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 210,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        marginBottom: \"10px\"\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: handleAddNode,\n        children: \"Add Node\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 212,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: handleSave,\n        style: {\n          marginLeft: \"10px\"\n        },\n        children: \"Save Flow Chart\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 213,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 211,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      ref: containerRef,\n      style: {\n        position: \"relative\",\n        width: \"100%\",\n        height: \"600px\",\n        border: \"1px solid #ccc\",\n        overflow: \"hidden\"\n      },\n      onMouseMove: e => {\n        handleMouseMove(e);\n        handleResizeMouseMove(e);\n      },\n      onMouseUp: () => {\n        handleMouseUp();\n        handleResizeMouseUp();\n      },\n      children: [nodes.filter(n => n.type === \"phase\").map(phase => {\n        const bounds = computePhaseBounds(phase);\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            position: \"absolute\",\n            left: bounds.x,\n            top: bounds.y,\n            width: bounds.width,\n            height: bounds.height,\n            border: \"2px dashed blue\",\n            pointerEvents: \"none\",\n            boxSizing: \"border-box\",\n            zIndex: 1\n          }\n        }, `phase-bounds-${phase.id}`, false, {\n          fileName: _jsxFileName,\n          lineNumber: 231,\n          columnNumber: 13\n        }, this);\n      }), nodes.map(node => /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          position: \"absolute\",\n          left: node.position.x,\n          top: node.position.y,\n          width: node.width,\n          height: node.height,\n          border: selectedNode && selectedNode.id === node.id ? \"2px solid red\" : \"1px solid black\",\n          backgroundColor: \"#fff\",\n          boxSizing: \"border-box\",\n          cursor: \"move\",\n          zIndex: node.type === \"phase\" ? 2 : 3\n        },\n        onMouseDown: e => {\n          handleMouseDown(e, node.id);\n          // 若拖曳的是 Phase，記錄拖曳時的起始位置\n        },\n        onClick: e => handleSelectNode(e, node.id),\n        children: [renderNodeContent(node), selectedNode && selectedNode.id === node.id && /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            position: \"absolute\",\n            right: 0,\n            bottom: 0,\n            width: \"10px\",\n            height: \"10px\",\n            backgroundColor: \"gray\",\n            cursor: \"se-resize\"\n          },\n          onMouseDown: e => handleResizeMouseDown(e, node.id)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 269,\n          columnNumber: 15\n        }, this)]\n      }, node.id, true, {\n        fileName: _jsxFileName,\n        lineNumber: 246,\n        columnNumber: 11\n      }, this))]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 215,\n      columnNumber: 7\n    }, this), selectedNode && /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        marginTop: \"20px\",\n        border: \"1px solid #ccc\",\n        padding: \"10px\"\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n        children: \"Edit Node Properties\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 288,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          children: \"Type:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 290,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n          name: \"type\",\n          value: selectedNode.type,\n          onChange: handleEditChange,\n          children: [/*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"phase\",\n            children: \"phase\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 292,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"task\",\n            children: \"task\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 293,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"subFlow\",\n            children: \"subFlow\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 294,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"iterative\",\n            children: \"iterative\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 295,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"note\",\n            children: \"note\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 296,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"extra\",\n            children: \"extra\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 297,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 291,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 289,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          children: \"Label:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 301,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          name: \"label\",\n          value: selectedNode.label,\n          onChange: handleEditChange\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 302,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 300,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          children: \"Description:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 305,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n          name: \"description\",\n          value: selectedNode.description,\n          onChange: handleEditChange\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 306,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 304,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          children: \"Link:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 309,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          name: \"link\",\n          value: selectedNode.link,\n          onChange: handleEditChange\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 310,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 308,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          children: \"Container ID (Phase):\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 313,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          name: \"containerId\",\n          value: selectedNode.containerId || \"\",\n          onChange: handleContainerChange,\n          placeholder: \"\\u8F38\\u5165 Phase \\u7BC0\\u9EDE ID\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 314,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 312,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          children: \"Extras (comma-separated):\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 317,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          name: \"extras\",\n          value: (selectedNode.extras || []).join(\",\"),\n          onChange: e => {\n            const arr = e.target.value.split(\",\").map(s => s.trim()).filter(s => s);\n            handleEditChange({\n              target: {\n                name: \"extras\",\n                value: arr\n              }\n            });\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 318,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 316,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          children: \"Delete this node:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 328,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleDeleteNode,\n          children: \"Delete\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 329,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 327,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 287,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 209,\n    columnNumber: 5\n  }, this);\n};\n_s(CustomFlowChartEditor, \"gS4hTC2aq5rtRlafCQozFNF4mJA=\", false, function () {\n  return [useParams];\n});\n_c = CustomFlowChartEditor;\nexport default CustomFlowChartEditor;\nvar _c;\n$RefreshReg$(_c, \"CustomFlowChartEditor\");","map":{"version":3,"names":["React","useState","useEffect","useRef","axios","useParams","jsxDEV","_jsxDEV","DEFAULT_WIDTH","DEFAULT_HEIGHT","PHASE_PADDING","CustomFlowChartEditor","_s","id","projectId","token","localStorage","getItem","API_URL","process","env","REACT_APP_API_URL","containerRef","nodes","setNodes","selectedNodeId","setSelectedNodeId","dragging","setDragging","nodeId","offset","x","y","resizing","setResizing","startPos","startSize","width","height","fetchFlowChart","res","get","headers","Authorization","data","error","console","handleMouseDown","e","stopPropagation","nodeElem","currentTarget","rect","getBoundingClientRect","clientX","left","clientY","top","handleMouseMove","containerRect","current","newX","newY","prev","map","n","deltaX","position","deltaY","type","parent","find","p","containerId","handleMouseUp","handleSelectNode","handleResizeMouseDown","node","handleResizeMouseMove","Math","max","handleResizeMouseUp","handleDeleteNode","filter","handleEditChange","name","value","target","handleContainerChange","handleAddNode","newNode","Date","now","label","description","extras","link","movePhaseChildren","phaseId","handleSave","put","flowChart","alert","computePhaseBounds","phase","children","length","xs","ys","minX","min","minY","maxX","maxY","renderConnections","selectedNode","fileName","_jsxFileName","lineNumber","columnNumber","style","marginBottom","onClick","marginLeft","ref","border","overflow","onMouseMove","onMouseUp","bounds","pointerEvents","boxSizing","zIndex","backgroundColor","cursor","onMouseDown","renderNodeContent","right","bottom","marginTop","padding","onChange","placeholder","join","arr","split","s","trim","_c","$RefreshReg$"],"sources":["/Users/chenguanyu/Desktop/yuniver_CRUD/client/src/pages/FlowChartEditor.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport axios from 'axios';\nimport { useParams } from 'react-router-dom';\n\n// 常數設定：預設節點尺寸、容器內邊距\nconst DEFAULT_WIDTH = 140;\nconst DEFAULT_HEIGHT = 80;\nconst PHASE_PADDING = 20;\n\nconst CustomFlowChartEditor = () => {\n  const { id: projectId } = useParams();\n  const token = localStorage.getItem('token');\n  const API_URL = process.env.REACT_APP_API_URL || 'http://localhost:5001/api';\n  const containerRef = useRef(null);\n\n  // 節點資料，每個節點物件包含：id, type, label, description, link, extras, position, width, height, containerId (如果屬於某 Phase)\n  const [nodes, setNodes] = useState([]);\n  // 儲存被選取的節點 id\n  const [selectedNodeId, setSelectedNodeId] = useState(null);\n  // 拖曳狀態：正在拖曳的節點 id及相對偏移量\n  const [dragging, setDragging] = useState({ nodeId: null, offset: { x: 0, y: 0 } });\n  // 調整大小狀態\n  const [resizing, setResizing] = useState({ nodeId: null, startPos: { x: 0, y: 0 }, startSize: { width: 0, height: 0 } });\n\n  // 讀取後端流程圖資料\n  useEffect(() => {\n    const fetchFlowChart = async () => {\n      try {\n        const res = await axios.get(`${API_URL}/projects/${projectId}/flowchart`, {\n          headers: { Authorization: `Bearer ${token}` },\n        });\n        // 預期回傳陣列，每個物件至少有 id, type, label, position, width, height, containerId (可選)\n        setNodes(res.data || []);\n      } catch (error) {\n        console.error(\"Failed to load flowchart:\", error);\n      }\n    };\n    fetchFlowChart();\n  }, [projectId, API_URL, token]);\n\n  // 拖曳開始：記錄拖曳節點和滑鼠偏移量\n  const handleMouseDown = (e, nodeId) => {\n    e.stopPropagation();\n    const nodeElem = e.currentTarget;\n    const rect = nodeElem.getBoundingClientRect();\n    setDragging({ nodeId, offset: { x: e.clientX - rect.left, y: e.clientY - rect.top } });\n  };\n\n  // 拖曳中：更新拖曳節點位置（如果是 Phase 且包含子節點，則一起移動）\n  const handleMouseMove = (e) => {\n    if (!dragging.nodeId) return;\n    const containerRect = containerRef.current.getBoundingClientRect();\n    const newX = e.clientX - containerRect.left - dragging.offset.x;\n    const newY = e.clientY - containerRect.top - dragging.offset.y;\n\n    setNodes(prev =>\n      prev.map(n => {\n        if (n.id === dragging.nodeId) {\n          // 如果是 Phase，計算位移後，同時移動內部節點\n          const deltaX = newX - n.position.x;\n          const deltaY = newY - n.position.y;\n          if (n.type === \"phase\") {\n            // 更新 Phase 節點\n            // 並更新所有屬於此 Phase 的子節點 (containerId === phase id)\n            return n;\n          }\n          return { ...n, position: { x: newX, y: newY } };\n        }\n        // 如果該節點屬於正在拖動的 Phase，移動它\n        if (dragging.nodeId) {\n          const parent = prev.find(p => p.id === dragging.nodeId);\n          if (parent && parent.type === \"phase\" && n.containerId === parent.id) {\n            const deltaX = newX - parent.position.x;\n            const deltaY = newY - parent.position.y;\n            return { ...n, position: { x: n.position.x + deltaX, y: n.position.y + deltaY } };\n          }\n        }\n        return n;\n      })\n    );\n  };\n\n  // 拖曳結束\n  const handleMouseUp = () => {\n    setDragging({ nodeId: null, offset: { x: 0, y: 0 } });\n  };\n\n  // 節點選取\n  const handleSelectNode = (e, nodeId) => {\n    e.stopPropagation();\n    setSelectedNodeId(nodeId);\n  };\n\n  // 開始調整大小（拖曳右下角）\n  const handleResizeMouseDown = (e, nodeId) => {\n    e.stopPropagation();\n    const node = nodes.find(n => n.id === nodeId);\n    setResizing({ nodeId, startPos: { x: e.clientX, y: e.clientY }, startSize: { width: node.width, height: node.height } });\n  };\n\n  // 調整大小中\n  const handleResizeMouseMove = (e) => {\n    if (!resizing.nodeId) return;\n    const deltaX = e.clientX - resizing.startPos.x;\n    const deltaY = e.clientY - resizing.startPos.y;\n    setNodes(prev =>\n      prev.map(n =>\n        n.id === resizing.nodeId ? { ...n, width: Math.max(50, resizing.startSize.width + deltaX), height: Math.max(30, resizing.startSize.height + deltaY) } : n\n      )\n    );\n  };\n\n  // 調整大小結束\n  const handleResizeMouseUp = () => {\n    setResizing({ nodeId: null, startPos: { x: 0, y: 0 }, startSize: { width: 0, height: 0 } });\n  };\n\n  // 刪除節點（若是 Phase，這裡只刪除 Phase 本身，不連帶刪除內部節點；可根據需求修改）\n  const handleDeleteNode = () => {\n    if (!selectedNodeId) return;\n    setNodes(prev => prev.filter(n => n.id !== selectedNodeId));\n    setSelectedNodeId(null);\n  };\n\n  // 側邊表單：更新屬性（type, label, description, link, extras, containerId）\n  const handleEditChange = (e) => {\n    if (!selectedNodeId) return;\n    const { name, value } = e.target;\n    setNodes(prev =>\n      prev.map(n =>\n        n.id === selectedNodeId ? { ...n, [name]: value } : n\n      )\n    );\n  };\n\n  // 更新 containerId（例如手動設定該節點屬於某 Phase）\n  const handleContainerChange = (e) => {\n    if (!selectedNodeId) return;\n    setNodes(prev =>\n      prev.map(n =>\n        n.id === selectedNodeId ? { ...n, containerId: e.target.value } : n\n      )\n    );\n  };\n\n  // 新增節點\n  const handleAddNode = () => {\n    const newNode = {\n      id: `${Date.now()}`,\n      type: \"task\",\n      label: \"New Node\",\n      description: \"\",\n      extras: [],\n      link: \"\",\n      containerId: \"\", // 空代表不在 Phase 裡\n      position: { x: 50, y: 50 },\n      width: DEFAULT_WIDTH,\n      height: DEFAULT_HEIGHT,\n    };\n    setNodes(prev => [...prev, newNode]);\n  };\n\n  // 當拖動階段 Phase 時，讓其內部節點也跟著移動\n  const movePhaseChildren = (phaseId, deltaX, deltaY) => {\n    setNodes(prev =>\n      prev.map(n =>\n        n.containerId === phaseId ? { ...n, position: { x: n.position.x + deltaX, y: n.position.y + deltaY } } : n\n      )\n    );\n  };\n\n  // 儲存流程圖資料到後端\n  const handleSave = async () => {\n    try {\n      await axios.put(`${API_URL}/projects/${projectId}/flowchart`,\n        { flowChart: nodes },\n        { headers: { Authorization: `Bearer ${token}` } }\n      );\n      alert(\"Flowchart saved successfully!\");\n    } catch (error) {\n      console.error(\"Failed to save flowchart:\", error);\n      alert(\"Save failed.\");\n    }\n  };\n\n  // 計算 Phase 節點的包覆區\n  const computePhaseBounds = (phase) => {\n    const children = nodes.filter(n => n.containerId === phase.id);\n    if (children.length === 0) return { x: phase.position.x, y: phase.position.y, width: phase.width, height: phase.height };\n    const xs = children.map(n => n.position.x);\n    const ys = children.map(n => n.position.y);\n    const minX = Math.min(...xs) - PHASE_PADDING;\n    const minY = Math.min(...ys) - PHASE_PADDING;\n    const maxX = Math.max(...children.map(n => n.position.x + n.width)) + PHASE_PADDING;\n    const maxY = Math.max(...children.map(n => n.position.y + n.height)) + PHASE_PADDING;\n    return { x: minX, y: minY, width: maxX - minX, height: maxY - minY };\n  };\n\n  // 依據每個節點資料渲染連線（若 node 有 children 陣列存放連線關係，可自行擴充）\n  const renderConnections = () => {\n    // 這裡我們不另外處理 Phase 內的連線\n    return null;\n  };\n\n  // 取得被選取的節點\n  const selectedNode = nodes.find(n => n.id === selectedNodeId);\n\n  return (\n    <div>\n      <h2>Custom Flow Chart Editor</h2>\n      <div style={{ marginBottom: \"10px\" }}>\n        <button onClick={handleAddNode}>Add Node</button>\n        <button onClick={handleSave} style={{ marginLeft: \"10px\" }}>Save Flow Chart</button>\n      </div>\n      <div\n        ref={containerRef}\n        style={{ position: \"relative\", width: \"100%\", height: \"600px\", border: \"1px solid #ccc\", overflow: \"hidden\" }}\n        onMouseMove={(e) => {\n          handleMouseMove(e);\n          handleResizeMouseMove(e);\n        }}\n        onMouseUp={() => {\n          handleMouseUp();\n          handleResizeMouseUp();\n        }}\n      >\n        {/* 渲染 Phase 節點的包覆區 */}\n        {nodes.filter(n => n.type === \"phase\").map(phase => {\n          const bounds = computePhaseBounds(phase);\n          return (\n            <div key={`phase-bounds-${phase.id}`} style={{\n              position: \"absolute\",\n              left: bounds.x,\n              top: bounds.y,\n              width: bounds.width,\n              height: bounds.height,\n              border: \"2px dashed blue\",\n              pointerEvents: \"none\",\n              boxSizing: \"border-box\",\n              zIndex: 1\n            }} />\n          );\n        })}\n        {/* 渲染節點 */}\n        {nodes.map(node => (\n          <div\n            key={node.id}\n            style={{\n              position: \"absolute\",\n              left: node.position.x,\n              top: node.position.y,\n              width: node.width,\n              height: node.height,\n              border: selectedNode && selectedNode.id === node.id ? \"2px solid red\" : \"1px solid black\",\n              backgroundColor: \"#fff\",\n              boxSizing: \"border-box\",\n              cursor: \"move\",\n              zIndex: node.type === \"phase\" ? 2 : 3\n            }}\n            onMouseDown={(e) => {\n              handleMouseDown(e, node.id);\n              // 若拖曳的是 Phase，記錄拖曳時的起始位置\n            }}\n            onClick={(e) => handleSelectNode(e, node.id)}\n          >\n            {renderNodeContent(node)}\n            {/* 如果此節點是被選中，顯示右下角調整大小手把 */}\n            {selectedNode && selectedNode.id === node.id && (\n              <div\n                style={{\n                  position: \"absolute\",\n                  right: 0,\n                  bottom: 0,\n                  width: \"10px\",\n                  height: \"10px\",\n                  backgroundColor: \"gray\",\n                  cursor: \"se-resize\"\n                }}\n                onMouseDown={(e) => handleResizeMouseDown(e, node.id)}\n              />\n            )}\n          </div>\n        ))}\n      </div>\n      {/* 側邊編輯表單 */}\n      {selectedNode && (\n        <div style={{ marginTop: \"20px\", border: \"1px solid #ccc\", padding: \"10px\" }}>\n          <h3>Edit Node Properties</h3>\n          <div>\n            <label>Type:</label>\n            <select name=\"type\" value={selectedNode.type} onChange={handleEditChange}>\n              <option value=\"phase\">phase</option>\n              <option value=\"task\">task</option>\n              <option value=\"subFlow\">subFlow</option>\n              <option value=\"iterative\">iterative</option>\n              <option value=\"note\">note</option>\n              <option value=\"extra\">extra</option>\n            </select>\n          </div>\n          <div>\n            <label>Label:</label>\n            <input name=\"label\" value={selectedNode.label} onChange={handleEditChange} />\n          </div>\n          <div>\n            <label>Description:</label>\n            <textarea name=\"description\" value={selectedNode.description} onChange={handleEditChange} />\n          </div>\n          <div>\n            <label>Link:</label>\n            <input name=\"link\" value={selectedNode.link} onChange={handleEditChange} />\n          </div>\n          <div>\n            <label>Container ID (Phase):</label>\n            <input name=\"containerId\" value={selectedNode.containerId || \"\"} onChange={handleContainerChange} placeholder=\"輸入 Phase 節點 ID\" />\n          </div>\n          <div>\n            <label>Extras (comma-separated):</label>\n            <input\n              name=\"extras\"\n              value={(selectedNode.extras || []).join(\",\")}\n              onChange={(e) => {\n                const arr = e.target.value.split(\",\").map(s => s.trim()).filter(s => s);\n                handleEditChange({ target: { name: \"extras\", value: arr } });\n              }}\n            />\n          </div>\n          <div>\n            <label>Delete this node:</label>\n            <button onClick={handleDeleteNode}>Delete</button>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default CustomFlowChartEditor;\n"],"mappings":";;AAAA,OAAOA,KAAK,IAAIC,QAAQ,EAAEC,SAAS,EAAEC,MAAM,QAAQ,OAAO;AAC1D,OAAOC,KAAK,MAAM,OAAO;AACzB,SAASC,SAAS,QAAQ,kBAAkB;;AAE5C;AAAA,SAAAC,MAAA,IAAAC,OAAA;AACA,MAAMC,aAAa,GAAG,GAAG;AACzB,MAAMC,cAAc,GAAG,EAAE;AACzB,MAAMC,aAAa,GAAG,EAAE;AAExB,MAAMC,qBAAqB,GAAGA,CAAA,KAAM;EAAAC,EAAA;EAClC,MAAM;IAAEC,EAAE,EAAEC;EAAU,CAAC,GAAGT,SAAS,CAAC,CAAC;EACrC,MAAMU,KAAK,GAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC;EAC3C,MAAMC,OAAO,GAAGC,OAAO,CAACC,GAAG,CAACC,iBAAiB,IAAI,2BAA2B;EAC5E,MAAMC,YAAY,GAAGnB,MAAM,CAAC,IAAI,CAAC;;EAEjC;EACA,MAAM,CAACoB,KAAK,EAAEC,QAAQ,CAAC,GAAGvB,QAAQ,CAAC,EAAE,CAAC;EACtC;EACA,MAAM,CAACwB,cAAc,EAAEC,iBAAiB,CAAC,GAAGzB,QAAQ,CAAC,IAAI,CAAC;EAC1D;EACA,MAAM,CAAC0B,QAAQ,EAAEC,WAAW,CAAC,GAAG3B,QAAQ,CAAC;IAAE4B,MAAM,EAAE,IAAI;IAAEC,MAAM,EAAE;MAAEC,CAAC,EAAE,CAAC;MAAEC,CAAC,EAAE;IAAE;EAAE,CAAC,CAAC;EAClF;EACA,MAAM,CAACC,QAAQ,EAAEC,WAAW,CAAC,GAAGjC,QAAQ,CAAC;IAAE4B,MAAM,EAAE,IAAI;IAAEM,QAAQ,EAAE;MAAEJ,CAAC,EAAE,CAAC;MAAEC,CAAC,EAAE;IAAE,CAAC;IAAEI,SAAS,EAAE;MAAEC,KAAK,EAAE,CAAC;MAAEC,MAAM,EAAE;IAAE;EAAE,CAAC,CAAC;;EAExH;EACApC,SAAS,CAAC,MAAM;IACd,MAAMqC,cAAc,GAAG,MAAAA,CAAA,KAAY;MACjC,IAAI;QACF,MAAMC,GAAG,GAAG,MAAMpC,KAAK,CAACqC,GAAG,CAAC,GAAGvB,OAAO,aAAaJ,SAAS,YAAY,EAAE;UACxE4B,OAAO,EAAE;YAAEC,aAAa,EAAE,UAAU5B,KAAK;UAAG;QAC9C,CAAC,CAAC;QACF;QACAS,QAAQ,CAACgB,GAAG,CAACI,IAAI,IAAI,EAAE,CAAC;MAC1B,CAAC,CAAC,OAAOC,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,2BAA2B,EAAEA,KAAK,CAAC;MACnD;IACF,CAAC;IACDN,cAAc,CAAC,CAAC;EAClB,CAAC,EAAE,CAACzB,SAAS,EAAEI,OAAO,EAAEH,KAAK,CAAC,CAAC;;EAE/B;EACA,MAAMgC,eAAe,GAAGA,CAACC,CAAC,EAAEnB,MAAM,KAAK;IACrCmB,CAAC,CAACC,eAAe,CAAC,CAAC;IACnB,MAAMC,QAAQ,GAAGF,CAAC,CAACG,aAAa;IAChC,MAAMC,IAAI,GAAGF,QAAQ,CAACG,qBAAqB,CAAC,CAAC;IAC7CzB,WAAW,CAAC;MAAEC,MAAM;MAAEC,MAAM,EAAE;QAAEC,CAAC,EAAEiB,CAAC,CAACM,OAAO,GAAGF,IAAI,CAACG,IAAI;QAAEvB,CAAC,EAAEgB,CAAC,CAACQ,OAAO,GAAGJ,IAAI,CAACK;MAAI;IAAE,CAAC,CAAC;EACxF,CAAC;;EAED;EACA,MAAMC,eAAe,GAAIV,CAAC,IAAK;IAC7B,IAAI,CAACrB,QAAQ,CAACE,MAAM,EAAE;IACtB,MAAM8B,aAAa,GAAGrC,YAAY,CAACsC,OAAO,CAACP,qBAAqB,CAAC,CAAC;IAClE,MAAMQ,IAAI,GAAGb,CAAC,CAACM,OAAO,GAAGK,aAAa,CAACJ,IAAI,GAAG5B,QAAQ,CAACG,MAAM,CAACC,CAAC;IAC/D,MAAM+B,IAAI,GAAGd,CAAC,CAACQ,OAAO,GAAGG,aAAa,CAACF,GAAG,GAAG9B,QAAQ,CAACG,MAAM,CAACE,CAAC;IAE9DR,QAAQ,CAACuC,IAAI,IACXA,IAAI,CAACC,GAAG,CAACC,CAAC,IAAI;MACZ,IAAIA,CAAC,CAACpD,EAAE,KAAKc,QAAQ,CAACE,MAAM,EAAE;QAC5B;QACA,MAAMqC,MAAM,GAAGL,IAAI,GAAGI,CAAC,CAACE,QAAQ,CAACpC,CAAC;QAClC,MAAMqC,MAAM,GAAGN,IAAI,GAAGG,CAAC,CAACE,QAAQ,CAACnC,CAAC;QAClC,IAAIiC,CAAC,CAACI,IAAI,KAAK,OAAO,EAAE;UACtB;UACA;UACA,OAAOJ,CAAC;QACV;QACA,OAAO;UAAE,GAAGA,CAAC;UAAEE,QAAQ,EAAE;YAAEpC,CAAC,EAAE8B,IAAI;YAAE7B,CAAC,EAAE8B;UAAK;QAAE,CAAC;MACjD;MACA;MACA,IAAInC,QAAQ,CAACE,MAAM,EAAE;QACnB,MAAMyC,MAAM,GAAGP,IAAI,CAACQ,IAAI,CAACC,CAAC,IAAIA,CAAC,CAAC3D,EAAE,KAAKc,QAAQ,CAACE,MAAM,CAAC;QACvD,IAAIyC,MAAM,IAAIA,MAAM,CAACD,IAAI,KAAK,OAAO,IAAIJ,CAAC,CAACQ,WAAW,KAAKH,MAAM,CAACzD,EAAE,EAAE;UACpE,MAAMqD,MAAM,GAAGL,IAAI,GAAGS,MAAM,CAACH,QAAQ,CAACpC,CAAC;UACvC,MAAMqC,MAAM,GAAGN,IAAI,GAAGQ,MAAM,CAACH,QAAQ,CAACnC,CAAC;UACvC,OAAO;YAAE,GAAGiC,CAAC;YAAEE,QAAQ,EAAE;cAAEpC,CAAC,EAAEkC,CAAC,CAACE,QAAQ,CAACpC,CAAC,GAAGmC,MAAM;cAAElC,CAAC,EAAEiC,CAAC,CAACE,QAAQ,CAACnC,CAAC,GAAGoC;YAAO;UAAE,CAAC;QACnF;MACF;MACA,OAAOH,CAAC;IACV,CAAC,CACH,CAAC;EACH,CAAC;;EAED;EACA,MAAMS,aAAa,GAAGA,CAAA,KAAM;IAC1B9C,WAAW,CAAC;MAAEC,MAAM,EAAE,IAAI;MAAEC,MAAM,EAAE;QAAEC,CAAC,EAAE,CAAC;QAAEC,CAAC,EAAE;MAAE;IAAE,CAAC,CAAC;EACvD,CAAC;;EAED;EACA,MAAM2C,gBAAgB,GAAGA,CAAC3B,CAAC,EAAEnB,MAAM,KAAK;IACtCmB,CAAC,CAACC,eAAe,CAAC,CAAC;IACnBvB,iBAAiB,CAACG,MAAM,CAAC;EAC3B,CAAC;;EAED;EACA,MAAM+C,qBAAqB,GAAGA,CAAC5B,CAAC,EAAEnB,MAAM,KAAK;IAC3CmB,CAAC,CAACC,eAAe,CAAC,CAAC;IACnB,MAAM4B,IAAI,GAAGtD,KAAK,CAACgD,IAAI,CAACN,CAAC,IAAIA,CAAC,CAACpD,EAAE,KAAKgB,MAAM,CAAC;IAC7CK,WAAW,CAAC;MAAEL,MAAM;MAAEM,QAAQ,EAAE;QAAEJ,CAAC,EAAEiB,CAAC,CAACM,OAAO;QAAEtB,CAAC,EAAEgB,CAAC,CAACQ;MAAQ,CAAC;MAAEpB,SAAS,EAAE;QAAEC,KAAK,EAAEwC,IAAI,CAACxC,KAAK;QAAEC,MAAM,EAAEuC,IAAI,CAACvC;MAAO;IAAE,CAAC,CAAC;EAC1H,CAAC;;EAED;EACA,MAAMwC,qBAAqB,GAAI9B,CAAC,IAAK;IACnC,IAAI,CAACf,QAAQ,CAACJ,MAAM,EAAE;IACtB,MAAMqC,MAAM,GAAGlB,CAAC,CAACM,OAAO,GAAGrB,QAAQ,CAACE,QAAQ,CAACJ,CAAC;IAC9C,MAAMqC,MAAM,GAAGpB,CAAC,CAACQ,OAAO,GAAGvB,QAAQ,CAACE,QAAQ,CAACH,CAAC;IAC9CR,QAAQ,CAACuC,IAAI,IACXA,IAAI,CAACC,GAAG,CAACC,CAAC,IACRA,CAAC,CAACpD,EAAE,KAAKoB,QAAQ,CAACJ,MAAM,GAAG;MAAE,GAAGoC,CAAC;MAAE5B,KAAK,EAAE0C,IAAI,CAACC,GAAG,CAAC,EAAE,EAAE/C,QAAQ,CAACG,SAAS,CAACC,KAAK,GAAG6B,MAAM,CAAC;MAAE5B,MAAM,EAAEyC,IAAI,CAACC,GAAG,CAAC,EAAE,EAAE/C,QAAQ,CAACG,SAAS,CAACE,MAAM,GAAG8B,MAAM;IAAE,CAAC,GAAGH,CAC1J,CACF,CAAC;EACH,CAAC;;EAED;EACA,MAAMgB,mBAAmB,GAAGA,CAAA,KAAM;IAChC/C,WAAW,CAAC;MAAEL,MAAM,EAAE,IAAI;MAAEM,QAAQ,EAAE;QAAEJ,CAAC,EAAE,CAAC;QAAEC,CAAC,EAAE;MAAE,CAAC;MAAEI,SAAS,EAAE;QAAEC,KAAK,EAAE,CAAC;QAAEC,MAAM,EAAE;MAAE;IAAE,CAAC,CAAC;EAC7F,CAAC;;EAED;EACA,MAAM4C,gBAAgB,GAAGA,CAAA,KAAM;IAC7B,IAAI,CAACzD,cAAc,EAAE;IACrBD,QAAQ,CAACuC,IAAI,IAAIA,IAAI,CAACoB,MAAM,CAAClB,CAAC,IAAIA,CAAC,CAACpD,EAAE,KAAKY,cAAc,CAAC,CAAC;IAC3DC,iBAAiB,CAAC,IAAI,CAAC;EACzB,CAAC;;EAED;EACA,MAAM0D,gBAAgB,GAAIpC,CAAC,IAAK;IAC9B,IAAI,CAACvB,cAAc,EAAE;IACrB,MAAM;MAAE4D,IAAI;MAAEC;IAAM,CAAC,GAAGtC,CAAC,CAACuC,MAAM;IAChC/D,QAAQ,CAACuC,IAAI,IACXA,IAAI,CAACC,GAAG,CAACC,CAAC,IACRA,CAAC,CAACpD,EAAE,KAAKY,cAAc,GAAG;MAAE,GAAGwC,CAAC;MAAE,CAACoB,IAAI,GAAGC;IAAM,CAAC,GAAGrB,CACtD,CACF,CAAC;EACH,CAAC;;EAED;EACA,MAAMuB,qBAAqB,GAAIxC,CAAC,IAAK;IACnC,IAAI,CAACvB,cAAc,EAAE;IACrBD,QAAQ,CAACuC,IAAI,IACXA,IAAI,CAACC,GAAG,CAACC,CAAC,IACRA,CAAC,CAACpD,EAAE,KAAKY,cAAc,GAAG;MAAE,GAAGwC,CAAC;MAAEQ,WAAW,EAAEzB,CAAC,CAACuC,MAAM,CAACD;IAAM,CAAC,GAAGrB,CACpE,CACF,CAAC;EACH,CAAC;;EAED;EACA,MAAMwB,aAAa,GAAGA,CAAA,KAAM;IAC1B,MAAMC,OAAO,GAAG;MACd7E,EAAE,EAAE,GAAG8E,IAAI,CAACC,GAAG,CAAC,CAAC,EAAE;MACnBvB,IAAI,EAAE,MAAM;MACZwB,KAAK,EAAE,UAAU;MACjBC,WAAW,EAAE,EAAE;MACfC,MAAM,EAAE,EAAE;MACVC,IAAI,EAAE,EAAE;MACRvB,WAAW,EAAE,EAAE;MAAE;MACjBN,QAAQ,EAAE;QAAEpC,CAAC,EAAE,EAAE;QAAEC,CAAC,EAAE;MAAG,CAAC;MAC1BK,KAAK,EAAE7B,aAAa;MACpB8B,MAAM,EAAE7B;IACV,CAAC;IACDe,QAAQ,CAACuC,IAAI,IAAI,CAAC,GAAGA,IAAI,EAAE2B,OAAO,CAAC,CAAC;EACtC,CAAC;;EAED;EACA,MAAMO,iBAAiB,GAAGA,CAACC,OAAO,EAAEhC,MAAM,EAAEE,MAAM,KAAK;IACrD5C,QAAQ,CAACuC,IAAI,IACXA,IAAI,CAACC,GAAG,CAACC,CAAC,IACRA,CAAC,CAACQ,WAAW,KAAKyB,OAAO,GAAG;MAAE,GAAGjC,CAAC;MAAEE,QAAQ,EAAE;QAAEpC,CAAC,EAAEkC,CAAC,CAACE,QAAQ,CAACpC,CAAC,GAAGmC,MAAM;QAAElC,CAAC,EAAEiC,CAAC,CAACE,QAAQ,CAACnC,CAAC,GAAGoC;MAAO;IAAE,CAAC,GAAGH,CAC3G,CACF,CAAC;EACH,CAAC;;EAED;EACA,MAAMkC,UAAU,GAAG,MAAAA,CAAA,KAAY;IAC7B,IAAI;MACF,MAAM/F,KAAK,CAACgG,GAAG,CAAC,GAAGlF,OAAO,aAAaJ,SAAS,YAAY,EAC1D;QAAEuF,SAAS,EAAE9E;MAAM,CAAC,EACpB;QAAEmB,OAAO,EAAE;UAAEC,aAAa,EAAE,UAAU5B,KAAK;QAAG;MAAE,CAClD,CAAC;MACDuF,KAAK,CAAC,+BAA+B,CAAC;IACxC,CAAC,CAAC,OAAOzD,KAAK,EAAE;MACdC,OAAO,CAACD,KAAK,CAAC,2BAA2B,EAAEA,KAAK,CAAC;MACjDyD,KAAK,CAAC,cAAc,CAAC;IACvB;EACF,CAAC;;EAED;EACA,MAAMC,kBAAkB,GAAIC,KAAK,IAAK;IACpC,MAAMC,QAAQ,GAAGlF,KAAK,CAAC4D,MAAM,CAAClB,CAAC,IAAIA,CAAC,CAACQ,WAAW,KAAK+B,KAAK,CAAC3F,EAAE,CAAC;IAC9D,IAAI4F,QAAQ,CAACC,MAAM,KAAK,CAAC,EAAE,OAAO;MAAE3E,CAAC,EAAEyE,KAAK,CAACrC,QAAQ,CAACpC,CAAC;MAAEC,CAAC,EAAEwE,KAAK,CAACrC,QAAQ,CAACnC,CAAC;MAAEK,KAAK,EAAEmE,KAAK,CAACnE,KAAK;MAAEC,MAAM,EAAEkE,KAAK,CAAClE;IAAO,CAAC;IACxH,MAAMqE,EAAE,GAAGF,QAAQ,CAACzC,GAAG,CAACC,CAAC,IAAIA,CAAC,CAACE,QAAQ,CAACpC,CAAC,CAAC;IAC1C,MAAM6E,EAAE,GAAGH,QAAQ,CAACzC,GAAG,CAACC,CAAC,IAAIA,CAAC,CAACE,QAAQ,CAACnC,CAAC,CAAC;IAC1C,MAAM6E,IAAI,GAAG9B,IAAI,CAAC+B,GAAG,CAAC,GAAGH,EAAE,CAAC,GAAGjG,aAAa;IAC5C,MAAMqG,IAAI,GAAGhC,IAAI,CAAC+B,GAAG,CAAC,GAAGF,EAAE,CAAC,GAAGlG,aAAa;IAC5C,MAAMsG,IAAI,GAAGjC,IAAI,CAACC,GAAG,CAAC,GAAGyB,QAAQ,CAACzC,GAAG,CAACC,CAAC,IAAIA,CAAC,CAACE,QAAQ,CAACpC,CAAC,GAAGkC,CAAC,CAAC5B,KAAK,CAAC,CAAC,GAAG3B,aAAa;IACnF,MAAMuG,IAAI,GAAGlC,IAAI,CAACC,GAAG,CAAC,GAAGyB,QAAQ,CAACzC,GAAG,CAACC,CAAC,IAAIA,CAAC,CAACE,QAAQ,CAACnC,CAAC,GAAGiC,CAAC,CAAC3B,MAAM,CAAC,CAAC,GAAG5B,aAAa;IACpF,OAAO;MAAEqB,CAAC,EAAE8E,IAAI;MAAE7E,CAAC,EAAE+E,IAAI;MAAE1E,KAAK,EAAE2E,IAAI,GAAGH,IAAI;MAAEvE,MAAM,EAAE2E,IAAI,GAAGF;IAAK,CAAC;EACtE,CAAC;;EAED;EACA,MAAMG,iBAAiB,GAAGA,CAAA,KAAM;IAC9B;IACA,OAAO,IAAI;EACb,CAAC;;EAED;EACA,MAAMC,YAAY,GAAG5F,KAAK,CAACgD,IAAI,CAACN,CAAC,IAAIA,CAAC,CAACpD,EAAE,KAAKY,cAAc,CAAC;EAE7D,oBACElB,OAAA;IAAAkG,QAAA,gBACElG,OAAA;MAAAkG,QAAA,EAAI;IAAwB;MAAAW,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAI,CAAC,eACjChH,OAAA;MAAKiH,KAAK,EAAE;QAAEC,YAAY,EAAE;MAAO,CAAE;MAAAhB,QAAA,gBACnClG,OAAA;QAAQmH,OAAO,EAAEjC,aAAc;QAAAgB,QAAA,EAAC;MAAQ;QAAAW,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAQ,CAAC,eACjDhH,OAAA;QAAQmH,OAAO,EAAEvB,UAAW;QAACqB,KAAK,EAAE;UAAEG,UAAU,EAAE;QAAO,CAAE;QAAAlB,QAAA,EAAC;MAAe;QAAAW,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAQ,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACjF,CAAC,eACNhH,OAAA;MACEqH,GAAG,EAAEtG,YAAa;MAClBkG,KAAK,EAAE;QAAErD,QAAQ,EAAE,UAAU;QAAE9B,KAAK,EAAE,MAAM;QAAEC,MAAM,EAAE,OAAO;QAAEuF,MAAM,EAAE,gBAAgB;QAAEC,QAAQ,EAAE;MAAS,CAAE;MAC9GC,WAAW,EAAG/E,CAAC,IAAK;QAClBU,eAAe,CAACV,CAAC,CAAC;QAClB8B,qBAAqB,CAAC9B,CAAC,CAAC;MAC1B,CAAE;MACFgF,SAAS,EAAEA,CAAA,KAAM;QACftD,aAAa,CAAC,CAAC;QACfO,mBAAmB,CAAC,CAAC;MACvB,CAAE;MAAAwB,QAAA,GAGDlF,KAAK,CAAC4D,MAAM,CAAClB,CAAC,IAAIA,CAAC,CAACI,IAAI,KAAK,OAAO,CAAC,CAACL,GAAG,CAACwC,KAAK,IAAI;QAClD,MAAMyB,MAAM,GAAG1B,kBAAkB,CAACC,KAAK,CAAC;QACxC,oBACEjG,OAAA;UAAsCiH,KAAK,EAAE;YAC3CrD,QAAQ,EAAE,UAAU;YACpBZ,IAAI,EAAE0E,MAAM,CAAClG,CAAC;YACd0B,GAAG,EAAEwE,MAAM,CAACjG,CAAC;YACbK,KAAK,EAAE4F,MAAM,CAAC5F,KAAK;YACnBC,MAAM,EAAE2F,MAAM,CAAC3F,MAAM;YACrBuF,MAAM,EAAE,iBAAiB;YACzBK,aAAa,EAAE,MAAM;YACrBC,SAAS,EAAE,YAAY;YACvBC,MAAM,EAAE;UACV;QAAE,GAVQ,gBAAgB5B,KAAK,CAAC3F,EAAE,EAAE;UAAAuG,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAUhC,CAAC;MAET,CAAC,CAAC,EAEDhG,KAAK,CAACyC,GAAG,CAACa,IAAI,iBACbtE,OAAA;QAEEiH,KAAK,EAAE;UACLrD,QAAQ,EAAE,UAAU;UACpBZ,IAAI,EAAEsB,IAAI,CAACV,QAAQ,CAACpC,CAAC;UACrB0B,GAAG,EAAEoB,IAAI,CAACV,QAAQ,CAACnC,CAAC;UACpBK,KAAK,EAAEwC,IAAI,CAACxC,KAAK;UACjBC,MAAM,EAAEuC,IAAI,CAACvC,MAAM;UACnBuF,MAAM,EAAEV,YAAY,IAAIA,YAAY,CAACtG,EAAE,KAAKgE,IAAI,CAAChE,EAAE,GAAG,eAAe,GAAG,iBAAiB;UACzFwH,eAAe,EAAE,MAAM;UACvBF,SAAS,EAAE,YAAY;UACvBG,MAAM,EAAE,MAAM;UACdF,MAAM,EAAEvD,IAAI,CAACR,IAAI,KAAK,OAAO,GAAG,CAAC,GAAG;QACtC,CAAE;QACFkE,WAAW,EAAGvF,CAAC,IAAK;UAClBD,eAAe,CAACC,CAAC,EAAE6B,IAAI,CAAChE,EAAE,CAAC;UAC3B;QACF,CAAE;QACF6G,OAAO,EAAG1E,CAAC,IAAK2B,gBAAgB,CAAC3B,CAAC,EAAE6B,IAAI,CAAChE,EAAE,CAAE;QAAA4F,QAAA,GAE5C+B,iBAAiB,CAAC3D,IAAI,CAAC,EAEvBsC,YAAY,IAAIA,YAAY,CAACtG,EAAE,KAAKgE,IAAI,CAAChE,EAAE,iBAC1CN,OAAA;UACEiH,KAAK,EAAE;YACLrD,QAAQ,EAAE,UAAU;YACpBsE,KAAK,EAAE,CAAC;YACRC,MAAM,EAAE,CAAC;YACTrG,KAAK,EAAE,MAAM;YACbC,MAAM,EAAE,MAAM;YACd+F,eAAe,EAAE,MAAM;YACvBC,MAAM,EAAE;UACV,CAAE;UACFC,WAAW,EAAGvF,CAAC,IAAK4B,qBAAqB,CAAC5B,CAAC,EAAE6B,IAAI,CAAChE,EAAE;QAAE;UAAAuG,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACvD,CACF;MAAA,GAlCI1C,IAAI,CAAChE,EAAE;QAAAuG,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAmCT,CACN,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACC,CAAC,EAELJ,YAAY,iBACX5G,OAAA;MAAKiH,KAAK,EAAE;QAAEmB,SAAS,EAAE,MAAM;QAAEd,MAAM,EAAE,gBAAgB;QAAEe,OAAO,EAAE;MAAO,CAAE;MAAAnC,QAAA,gBAC3ElG,OAAA;QAAAkG,QAAA,EAAI;MAAoB;QAAAW,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAI,CAAC,eAC7BhH,OAAA;QAAAkG,QAAA,gBACElG,OAAA;UAAAkG,QAAA,EAAO;QAAK;UAAAW,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAO,CAAC,eACpBhH,OAAA;UAAQ8E,IAAI,EAAC,MAAM;UAACC,KAAK,EAAE6B,YAAY,CAAC9C,IAAK;UAACwE,QAAQ,EAAEzD,gBAAiB;UAAAqB,QAAA,gBACvElG,OAAA;YAAQ+E,KAAK,EAAC,OAAO;YAAAmB,QAAA,EAAC;UAAK;YAAAW,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAQ,CAAC,eACpChH,OAAA;YAAQ+E,KAAK,EAAC,MAAM;YAAAmB,QAAA,EAAC;UAAI;YAAAW,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAQ,CAAC,eAClChH,OAAA;YAAQ+E,KAAK,EAAC,SAAS;YAAAmB,QAAA,EAAC;UAAO;YAAAW,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAQ,CAAC,eACxChH,OAAA;YAAQ+E,KAAK,EAAC,WAAW;YAAAmB,QAAA,EAAC;UAAS;YAAAW,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAQ,CAAC,eAC5ChH,OAAA;YAAQ+E,KAAK,EAAC,MAAM;YAAAmB,QAAA,EAAC;UAAI;YAAAW,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAQ,CAAC,eAClChH,OAAA;YAAQ+E,KAAK,EAAC,OAAO;YAAAmB,QAAA,EAAC;UAAK;YAAAW,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAQ,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAC9B,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACN,CAAC,eACNhH,OAAA;QAAAkG,QAAA,gBACElG,OAAA;UAAAkG,QAAA,EAAO;QAAM;UAAAW,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAO,CAAC,eACrBhH,OAAA;UAAO8E,IAAI,EAAC,OAAO;UAACC,KAAK,EAAE6B,YAAY,CAACtB,KAAM;UAACgD,QAAQ,EAAEzD;QAAiB;UAAAgC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAE,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAC1E,CAAC,eACNhH,OAAA;QAAAkG,QAAA,gBACElG,OAAA;UAAAkG,QAAA,EAAO;QAAY;UAAAW,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAO,CAAC,eAC3BhH,OAAA;UAAU8E,IAAI,EAAC,aAAa;UAACC,KAAK,EAAE6B,YAAY,CAACrB,WAAY;UAAC+C,QAAQ,EAAEzD;QAAiB;UAAAgC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAE,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACzF,CAAC,eACNhH,OAAA;QAAAkG,QAAA,gBACElG,OAAA;UAAAkG,QAAA,EAAO;QAAK;UAAAW,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAO,CAAC,eACpBhH,OAAA;UAAO8E,IAAI,EAAC,MAAM;UAACC,KAAK,EAAE6B,YAAY,CAACnB,IAAK;UAAC6C,QAAQ,EAAEzD;QAAiB;UAAAgC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAE,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACxE,CAAC,eACNhH,OAAA;QAAAkG,QAAA,gBACElG,OAAA;UAAAkG,QAAA,EAAO;QAAqB;UAAAW,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAO,CAAC,eACpChH,OAAA;UAAO8E,IAAI,EAAC,aAAa;UAACC,KAAK,EAAE6B,YAAY,CAAC1C,WAAW,IAAI,EAAG;UAACoE,QAAQ,EAAErD,qBAAsB;UAACsD,WAAW,EAAC;QAAgB;UAAA1B,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAE,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAC9H,CAAC,eACNhH,OAAA;QAAAkG,QAAA,gBACElG,OAAA;UAAAkG,QAAA,EAAO;QAAyB;UAAAW,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAO,CAAC,eACxChH,OAAA;UACE8E,IAAI,EAAC,QAAQ;UACbC,KAAK,EAAE,CAAC6B,YAAY,CAACpB,MAAM,IAAI,EAAE,EAAEgD,IAAI,CAAC,GAAG,CAAE;UAC7CF,QAAQ,EAAG7F,CAAC,IAAK;YACf,MAAMgG,GAAG,GAAGhG,CAAC,CAACuC,MAAM,CAACD,KAAK,CAAC2D,KAAK,CAAC,GAAG,CAAC,CAACjF,GAAG,CAACkF,CAAC,IAAIA,CAAC,CAACC,IAAI,CAAC,CAAC,CAAC,CAAChE,MAAM,CAAC+D,CAAC,IAAIA,CAAC,CAAC;YACvE9D,gBAAgB,CAAC;cAAEG,MAAM,EAAE;gBAAEF,IAAI,EAAE,QAAQ;gBAAEC,KAAK,EAAE0D;cAAI;YAAE,CAAC,CAAC;UAC9D;QAAE;UAAA5B,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACH,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACC,CAAC,eACNhH,OAAA;QAAAkG,QAAA,gBACElG,OAAA;UAAAkG,QAAA,EAAO;QAAiB;UAAAW,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAO,CAAC,eAChChH,OAAA;UAAQmH,OAAO,EAAExC,gBAAiB;UAAAuB,QAAA,EAAC;QAAM;UAAAW,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAQ,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAC/C,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACH,CACN;EAAA;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACE,CAAC;AAEV,CAAC;AAAC3G,EAAA,CArUID,qBAAqB;EAAA,QACCN,SAAS;AAAA;AAAA+I,EAAA,GAD/BzI,qBAAqB;AAuU3B,eAAeA,qBAAqB;AAAC,IAAAyI,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}