{"ast":null,"code":"var _jsxFileName = \"/Users/chenguanyu/Desktop/yuniver_CRUD/client/src/pages/CustomFlowChartEditor.jsx\",\n  _s = $RefreshSig$();\n// src/pages/CustomFlowChartEditor.jsx\nimport React, { useState, useEffect, useRef } from 'react';\nimport axios from 'axios';\nimport { useParams } from 'react-router-dom';\n\n// 預設尺寸與手把大小\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst NODE_WIDTH_DEFAULT = 140;\nconst NODE_HEIGHT_DEFAULT = 80;\nconst RESIZE_HANDLE_SIZE = 8;\n\n// 定義允許的父節點與子節點類型\nconst allowedChildren = {\n  phase: [\"task\"],\n  task: [\"subFlow\", \"iterative\", \"note\", \"extra\"]\n};\n\n// 根據節點狀態設定背景顏色（預設）\nconst getStatusColor = node => {\n  const statusColors = {\n    \"已完成\": \"#d4edda\",\n    \"進行中\": \"#cce5ff\",\n    \"規劃中\": \"#fff3cd\",\n    \"未開始\": \"#e2e3e5\",\n    \"自訂\": \"#f8d7da\"\n  };\n  if (node.type === \"phase\" || node.type === \"task\") {\n    return statusColors[node.status] || statusColors[\"未開始\"];\n  }\n  return \"#fff\";\n};\n\n// 根據形狀設定額外 CSS\nconst getShapeStyle = shape => {\n  switch (shape) {\n    case 'ellipse':\n      return {\n        borderRadius: \"50px\"\n      };\n    case 'parallelogram':\n      return {\n        transform: \"skew(-20deg)\"\n      };\n    case 'diamond':\n      return {\n        transform: \"rotate(45deg)\"\n      };\n    case 'rectangle':\n    default:\n      return {};\n  }\n};\n\n// 根據 type 渲染節點內容與樣式\nconst renderNodeContent = node => {\n  const commonStyle = {\n    padding: \"4px\",\n    textAlign: \"center\",\n    overflow: \"hidden\",\n    width: \"100%\",\n    height: \"100%\"\n  };\n  const statusText = node.type === \"phase\" || node.type === \"task\" ? `Status: ${node.status}${node.status === \"自訂\" && node.customStatus ? ` (${node.customStatus})` : \"\"}` : \"\";\n  switch (node.type) {\n    case \"phase\":\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          ...commonStyle\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            fontWeight: \"bold\",\n            fontSize: \"14px\"\n          },\n          children: node.label\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 57,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            fontSize: \"12px\"\n          },\n          children: node.description\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 58,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            fontSize: \"10px\",\n            marginTop: \"4px\"\n          },\n          children: statusText\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 59,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 56,\n        columnNumber: 9\n      }, this);\n    case \"task\":\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          ...commonStyle\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            fontWeight: \"bold\",\n            fontSize: \"14px\"\n          },\n          children: node.label\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 65,\n          columnNumber: 11\n        }, this), node.important && /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            color: \"red\",\n            fontSize: \"10px\"\n          },\n          children: \"Important\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 66,\n          columnNumber: 30\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            fontSize: \"12px\"\n          },\n          children: node.description\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 67,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            fontSize: \"10px\",\n            marginTop: \"4px\"\n          },\n          children: statusText\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 68,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 64,\n        columnNumber: 9\n      }, this);\n    case \"subFlow\":\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          ...commonStyle,\n          border: \"2px solid gray\",\n          backgroundColor: \"#f0f0f0\"\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            fontWeight: \"bold\",\n            fontSize: \"13px\"\n          },\n          children: node.label\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 74,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            fontSize: \"11px\"\n          },\n          children: node.description\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 75,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 73,\n        columnNumber: 9\n      }, this);\n    case \"iterative\":\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          ...commonStyle,\n          border: \"2px dotted green\",\n          backgroundColor: \"#e8ffe8\"\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            fontWeight: \"bold\",\n            fontSize: \"14px\"\n          },\n          children: [node.label, \" \\uD83D\\uDD04\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 81,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            fontSize: \"12px\"\n          },\n          children: node.description\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 82,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 80,\n        columnNumber: 9\n      }, this);\n    case \"note\":\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          ...commonStyle,\n          border: \"1px solid orange\",\n          backgroundColor: \"#fff7d6\"\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            fontStyle: \"italic\",\n            fontSize: \"12px\"\n          },\n          children: node.text || node.label\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 88,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            fontSize: \"10px\"\n          },\n          children: node.description\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 89,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 87,\n        columnNumber: 9\n      }, this);\n    case \"extra\":\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          ...commonStyle,\n          fontSize: \"10px\",\n          padding: \"2px\"\n        },\n        children: [\"\\u2022 \", node.content]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 94,\n        columnNumber: 9\n      }, this);\n    default:\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          ...commonStyle,\n          border: \"1px solid black\"\n        },\n        children: node.label || \"No Label\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 100,\n        columnNumber: 9\n      }, this);\n  }\n};\n\n// 輔助函式：判斷是否為拖曳節點的後代（根據 containerId 遞迴檢查）\nconst isDescendant = (draggedId, node, allNodes) => {\n  if (node.containerId === draggedId) return true;\n  if (!node.containerId) return false;\n  const parent = allNodes.find(n => n.id === node.containerId);\n  if (!parent) return false;\n  return isDescendant(draggedId, parent, allNodes);\n};\nconst CustomFlowChartEditor = () => {\n  _s();\n  // 只解構一次 useParams\n  const {\n    id\n  } = useParams();\n  // 若 id 前綴為 \"template_\" 則視為模板模式\n  const isTemplateMode = id.startsWith(\"template_\");\n  const realId = isTemplateMode ? id.split(\"_\")[1] : id;\n  const token = localStorage.getItem('token');\n  // 根據模式選擇 API 路徑\n  const API_URL = process.env.REACT_APP_API_URL || 'http://localhost:5001/api';\n  const containerRef = useRef(null);\n\n  // 節點資料，每個節點包含：id, type, label, description, link, extras, children, containerId, position, size, status, customStatus, shape\n  const [nodes, setNodes] = useState([]);\n  const [selectedNodeId, setSelectedNodeId] = useState(null);\n  const [draggingNodeId, setDraggingNodeId] = useState(null);\n  const [resizingNodeId, setResizingNodeId] = useState(null);\n  const [dragOffset, setDragOffset] = useState({\n    x: 0,\n    y: 0\n  });\n  const [resizeStart, setResizeStart] = useState({\n    x: 0,\n    y: 0,\n    width: 0,\n    height: 0\n  });\n\n  // 讀取流程圖資料，依模式選擇 API\n  useEffect(() => {\n    const fetchData = async () => {\n      if (realId === \"new\") {\n        const appliedTemplate = localStorage.getItem(\"appliedTemplate\");\n        if (appliedTemplate) {\n          setNodes(JSON.parse(appliedTemplate));\n        } else {\n          setNodes([]);\n        }\n        return;\n      }\n      try {\n        const url = isTemplateMode ? `${API_URL}/templates/${realId}` : `${API_URL}/projects/${realId}/flowchart`;\n        const res = await axios.get(url, {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        });\n        const data = isTemplateMode ? res.data.flowChart || [] : res.data || [];\n        const mapped = data.map(item => ({\n          ...item,\n          position: item.position || {\n            x: 50,\n            y: 50\n          },\n          size: item.size || {\n            width: NODE_WIDTH_DEFAULT,\n            height: NODE_HEIGHT_DEFAULT\n          },\n          containerId: item.containerId || null,\n          children: item.children || [],\n          status: item.type === \"phase\" || item.type === \"task\" ? item.status || \"未開始\" : item.status,\n          shape: item.type === \"phase\" || item.type === \"task\" ? item.shape || \"rectangle\" : item.shape\n        }));\n        setNodes(mapped);\n      } catch (error) {\n        console.error(\"Failed to load flowchart:\", error);\n      }\n    };\n    fetchData();\n  }, [realId, isTemplateMode, API_URL, token]);\n  const selectedNode = nodes.find(n => n.id === selectedNodeId);\n\n  // 更新選中節點屬性\n  const handleEditChange = e => {\n    if (!selectedNodeId) return;\n    const {\n      name,\n      value\n    } = e.target;\n    setNodes(prevNodes => prevNodes.map(n => n.id === selectedNodeId ? {\n      ...n,\n      [name]: value\n    } : n));\n  };\n\n  // 處理 children 欄位（逗號分隔轉陣列）\n  const handleChildrenChange = e => {\n    if (!selectedNodeId) return;\n    const children = e.target.value.split(\",\").map(s => s.trim()).filter(s => s);\n    setNodes(prevNodes => prevNodes.map(n => n.id === selectedNodeId ? {\n      ...n,\n      children\n    } : n));\n  };\n\n  // 拖曳開始\n  const handleMouseDown = (e, nodeId) => {\n    e.stopPropagation();\n    const nodeElem = e.currentTarget;\n    const rect = nodeElem.getBoundingClientRect();\n    setDraggingNodeId(nodeId);\n    setDragOffset({\n      x: e.clientX - rect.left,\n      y: e.clientY - rect.top\n    });\n  };\n\n  // 拖曳移動：更新拖曳節點及其所有後代（遞迴更新）\n  const handleMouseMove = e => {\n    if (draggingNodeId) {\n      setNodes(prevNodes => {\n        const draggedNode = prevNodes.find(n => n.id === draggingNodeId);\n        if (!draggedNode) return prevNodes;\n        const containerRect = containerRef.current.getBoundingClientRect();\n        const newX = e.clientX - containerRect.left - dragOffset.x;\n        const newY = e.clientY - containerRect.top - dragOffset.y;\n        const deltaX = newX - draggedNode.position.x;\n        const deltaY = newY - draggedNode.position.y;\n        return prevNodes.map(n => {\n          if (n.id === draggingNodeId || isDescendant(draggingNodeId, n, prevNodes)) {\n            return {\n              ...n,\n              position: {\n                x: n.position.x + deltaX,\n                y: n.position.y + deltaY\n              }\n            };\n          }\n          return n;\n        });\n      });\n    }\n    if (resizingNodeId) {\n      const containerRect = containerRef.current.getBoundingClientRect();\n      const dx = e.clientX - containerRect.left - resizeStart.x;\n      const dy = e.clientY - containerRect.top - resizeStart.y;\n      setNodes(prevNodes => prevNodes.map(n => {\n        if (n.id === resizingNodeId) {\n          return {\n            ...n,\n            size: {\n              width: Math.max(40, resizeStart.width + dx),\n              height: Math.max(30, resizeStart.height + dy)\n            }\n          };\n        }\n        return n;\n      }));\n    }\n  };\n\n  // 拖曳/縮放結束：檢查是否落入 Phase 或 Task 節點內，更新 containerId 與父節點 children\n  const handleMouseUp = () => {\n    if (draggingNodeId) {\n      setNodes(prevNodes => {\n        const draggedNode = prevNodes.find(n => n.id === draggingNodeId);\n        let newContainerId = null;\n        if (draggedNode) {\n          const center = {\n            x: draggedNode.position.x + draggedNode.size.width / 2,\n            y: draggedNode.position.y + draggedNode.size.height / 2\n          };\n          prevNodes.forEach(parent => {\n            if (parent.id !== draggedNode.id && (parent.type === \"phase\" || parent.type === \"task\")) {\n              if (center.x >= parent.position.x && center.x <= parent.position.x + parent.size.width && center.y >= parent.position.y && center.y <= parent.position.y + parent.size.height) {\n                const allowed = allowedChildren[parent.type] || [];\n                if (allowed.includes(draggedNode.type)) {\n                  newContainerId = parent.id;\n                }\n              }\n            }\n          });\n        }\n        return prevNodes.map(n => {\n          if (n.id === draggingNodeId) {\n            return {\n              ...n,\n              containerId: newContainerId\n            };\n          }\n          if (n.type === \"phase\" || n.type === \"task\") {\n            let newChildren = n.children ? [...n.children] : [];\n            newChildren = newChildren.filter(childId => childId !== draggingNodeId);\n            if (n.id === newContainerId) {\n              newChildren.push(draggingNodeId);\n            }\n            return {\n              ...n,\n              children: newChildren\n            };\n          }\n          return n;\n        });\n      });\n      setDraggingNodeId(null);\n    }\n    if (resizingNodeId) {\n      setResizingNodeId(null);\n    }\n  };\n\n  // 節點選取\n  const handleSelectNode = (e, nodeId) => {\n    e.stopPropagation();\n    setSelectedNodeId(nodeId);\n  };\n\n  // 開始縮放（點擊右下角手把）\n  const handleResizeMouseDown = (e, nodeId) => {\n    e.stopPropagation();\n    if (!selectedNode) return;\n    const containerRect = containerRef.current.getBoundingClientRect();\n    setResizingNodeId(nodeId);\n    setResizeStart({\n      x: e.clientX - containerRect.left,\n      y: e.clientY - containerRect.top,\n      width: selectedNode.size.width,\n      height: selectedNode.size.height\n    });\n  };\n\n  // 刪除節點\n  const handleDeleteNode = () => {\n    if (!selectedNodeId) return;\n    setNodes(prevNodes => prevNodes.filter(n => n.id !== selectedNodeId).map(n => n.containerId === selectedNodeId ? {\n      ...n,\n      containerId: null\n    } : n));\n    setSelectedNodeId(null);\n  };\n\n  // 新增節點：根據 type 新增，對於 phase 與 task 預設 shape 為 rectangle\n  const handleAddNewNode = (type = \"task\") => {\n    const newNode = {\n      id: `${Date.now()}`,\n      type,\n      label: type === \"phase\" ? \"New Phase\" : \"New Node\",\n      description: \"\",\n      link: \"\",\n      extras: [],\n      children: [],\n      containerId: null,\n      position: {\n        x: 50,\n        y: 50\n      },\n      size: {\n        width: NODE_WIDTH_DEFAULT,\n        height: NODE_HEIGHT_DEFAULT\n      },\n      status: type === \"phase\" || type === \"task\" ? \"未開始\" : \"\",\n      shape: type === \"phase\" || type === \"task\" ? \"rectangle\" : \"\"\n    };\n    setNodes(prev => [...prev, newNode]);\n  };\n\n  // 儲存流程圖，根據模式選擇 API 路徑\n  const handleSave = async () => {\n    try {\n      const url = isTemplateMode ? `${API_URL}/templates/${realId}` : `${API_URL}/projects/${realId}/flowchart`;\n      await axios.put(url, {\n        flowChart: nodes\n      }, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n      alert(\"Flowchart saved successfully!\");\n    } catch (error) {\n      console.error(\"Failed to save flowchart:\", error);\n      alert(\"Save failed.\");\n    }\n  };\n\n  // 下載流程圖 JSON，附加 name 欄位\n  const handleDownloadFlowchart = () => {\n    const templateName = prompt(\"請輸入模板名稱：\", `Flowchart Template ${realId}`);\n    const exportData = {\n      name: templateName,\n      flowChart: nodes\n    };\n    const dataStr = \"data:text/json;charset=utf-8,\" + encodeURIComponent(JSON.stringify(exportData, null, 2));\n    const a = document.createElement(\"a\");\n    a.href = dataStr;\n    a.download = `${templateName || \"flowchart_template\"}.json`;\n    document.body.appendChild(a);\n    a.click();\n    a.remove();\n  };\n\n  // 上傳流程圖 JSON 檔案並套用\n  const handleUploadFlowchart = e => {\n    const file = e.target.files[0];\n    if (!file) return;\n    const reader = new FileReader();\n    reader.onload = event => {\n      try {\n        const json = JSON.parse(event.target.result);\n        if (json.flowChart) {\n          setNodes(json.flowChart);\n        } else {\n          setNodes(json);\n        }\n      } catch (error) {\n        alert(\"Invalid JSON file\");\n      }\n    };\n    reader.readAsText(file);\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: [\"Custom Flow Chart Editor \", isTemplateMode ? \"(Template Mode)\" : \"\"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 405,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        marginBottom: \"10px\"\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => handleAddNewNode(\"task\"),\n        children: \"Add Task\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 407,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => handleAddNewNode(\"phase\"),\n        style: {\n          marginLeft: \"10px\"\n        },\n        children: \"Add Phase\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 408,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: handleSave,\n        style: {\n          marginLeft: \"10px\"\n        },\n        children: \"Save Flow Chart\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 409,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: handleDownloadFlowchart,\n        style: {\n          marginLeft: \"10px\"\n        },\n        children: \"Download Flowchart\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 410,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n        style: {\n          marginLeft: \"10px\"\n        },\n        children: [\"Import Flowchart:\", /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"file\",\n          accept: \".json\",\n          onChange: handleUploadFlowchart,\n          style: {\n            marginLeft: \"5px\"\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 413,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 411,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 406,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      ref: containerRef,\n      style: {\n        position: \"relative\",\n        width: \"100%\",\n        height: \"600px\",\n        border: \"1px solid #ccc\",\n        backgroundColor: \"#fafafa\"\n      },\n      onMouseMove: handleMouseMove,\n      onMouseUp: handleMouseUp,\n      children: nodes.map(node => {\n        const zIndex = node.containerId ? 10 : node.type === \"phase\" || node.type === \"task\" ? 5 : 1;\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            position: \"absolute\",\n            left: node.position.x,\n            top: node.position.y,\n            width: node.size.width,\n            height: node.size.height,\n            border: selectedNodeId === node.id ? \"2px solid red\" : \"1px solid #333\",\n            boxSizing: \"border-box\",\n            backgroundColor: node.type === \"phase\" || node.type === \"task\" ? getStatusColor(node) : \"#fff\",\n            cursor: \"move\",\n            zIndex,\n            ...getShapeStyle(node.shape)\n          },\n          onMouseDown: e => handleMouseDown(e, node.id),\n          onClick: e => handleSelectNode(e, node.id),\n          children: [renderNodeContent(node), selectedNodeId === node.id && /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              position: \"absolute\",\n              right: 0,\n              bottom: 0,\n              width: RESIZE_HANDLE_SIZE,\n              height: RESIZE_HANDLE_SIZE,\n              backgroundColor: \"gray\",\n              cursor: \"se-resize\"\n            },\n            onMouseDown: e => handleResizeMouseDown(e, node.id)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 445,\n            columnNumber: 17\n          }, this)]\n        }, node.id, true, {\n          fileName: _jsxFileName,\n          lineNumber: 425,\n          columnNumber: 13\n        }, this);\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 416,\n      columnNumber: 7\n    }, this), selectedNode && /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        marginTop: \"20px\",\n        border: \"1px solid #ccc\",\n        padding: \"10px\"\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n        children: \"Edit Node Properties\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 464,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          children: \"Type:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 466,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n          name: \"type\",\n          value: selectedNode.type,\n          onChange: handleEditChange,\n          children: [/*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"phase\",\n            children: \"phase\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 468,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"task\",\n            children: \"task\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 469,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"subFlow\",\n            children: \"subFlow\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 470,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"iterative\",\n            children: \"iterative\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 471,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"note\",\n            children: \"note\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 472,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"extra\",\n            children: \"extra\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 473,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 467,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 465,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          children: \"Label:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 477,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          name: \"label\",\n          value: selectedNode.label,\n          onChange: handleEditChange\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 478,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 476,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          children: \"Description:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 481,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n          name: \"description\",\n          value: selectedNode.description,\n          onChange: handleEditChange\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 482,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 480,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          children: \"Link:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 485,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          name: \"link\",\n          value: selectedNode.link,\n          onChange: handleEditChange\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 486,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 484,\n        columnNumber: 11\n      }, this), (selectedNode.type === \"phase\" || selectedNode.type === \"task\") && /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          children: \"Status:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 490,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n          name: \"status\",\n          value: selectedNode.status,\n          onChange: handleEditChange,\n          children: [/*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"\\u672A\\u958B\\u59CB\",\n            children: \"\\u672A\\u958B\\u59CB\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 492,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"\\u898F\\u5283\\u4E2D\",\n            children: \"\\u898F\\u5283\\u4E2D\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 493,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"\\u9032\\u884C\\u4E2D\",\n            children: \"\\u9032\\u884C\\u4E2D\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 494,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"\\u5DF2\\u5B8C\\u6210\",\n            children: \"\\u5DF2\\u5B8C\\u6210\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 495,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n            value: \"\\u81EA\\u8A02\",\n            children: \"\\u81EA\\u8A02\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 496,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 491,\n          columnNumber: 15\n        }, this), selectedNode.status === \"自訂\" && /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            children: \"Custom Status:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 500,\n            columnNumber: 19\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            name: \"customStatus\",\n            value: selectedNode.customStatus || \"\",\n            onChange: handleEditChange\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 501,\n            columnNumber: 19\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 499,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            children: \"Shape:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 505,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n            name: \"shape\",\n            value: selectedNode.shape,\n            onChange: handleEditChange,\n            children: [/*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"rectangle\",\n              children: \"\\u77E9\\u5F62\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 507,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"ellipse\",\n              children: \"\\u6A62\\u5713 / \\u85E5\\u4E38\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 508,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"parallelogram\",\n              children: \"\\u5E73\\u884C\\u56DB\\u908A\\u5F62\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 509,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"diamond\",\n              children: \"\\u83F1\\u5F62\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 510,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 506,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 504,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 489,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          children: \"Children (comma-separated IDs):\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 516,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          value: (selectedNode.children || []).join(\",\"),\n          onChange: handleChildrenChange\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 517,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 515,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          children: \"Extras (comma-separated):\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 523,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          name: \"extras\",\n          value: (selectedNode.extras || []).join(\",\"),\n          onChange: e => {\n            const arr = e.target.value.split(\",\").map(s => s.trim()).filter(s => s);\n            handleEditChange({\n              target: {\n                name: \"extras\",\n                value: arr\n              }\n            });\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 524,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 522,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          marginTop: \"10px\"\n        },\n        children: /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleDeleteNode,\n          children: \"Delete Node\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 534,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 533,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 463,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 404,\n    columnNumber: 5\n  }, this);\n};\n_s(CustomFlowChartEditor, \"Qt4rsdjiF1qJJIyFl3PtXssdxOw=\", false, function () {\n  return [useParams];\n});\n_c = CustomFlowChartEditor;\nexport default CustomFlowChartEditor;\nvar _c;\n$RefreshReg$(_c, \"CustomFlowChartEditor\");","map":{"version":3,"names":["React","useState","useEffect","useRef","axios","useParams","jsxDEV","_jsxDEV","NODE_WIDTH_DEFAULT","NODE_HEIGHT_DEFAULT","RESIZE_HANDLE_SIZE","allowedChildren","phase","task","getStatusColor","node","statusColors","type","status","getShapeStyle","shape","borderRadius","transform","renderNodeContent","commonStyle","padding","textAlign","overflow","width","height","statusText","customStatus","style","children","fontWeight","fontSize","label","fileName","_jsxFileName","lineNumber","columnNumber","description","marginTop","important","color","border","backgroundColor","fontStyle","text","content","isDescendant","draggedId","allNodes","containerId","parent","find","n","id","CustomFlowChartEditor","_s","isTemplateMode","startsWith","realId","split","token","localStorage","getItem","API_URL","process","env","REACT_APP_API_URL","containerRef","nodes","setNodes","selectedNodeId","setSelectedNodeId","draggingNodeId","setDraggingNodeId","resizingNodeId","setResizingNodeId","dragOffset","setDragOffset","x","y","resizeStart","setResizeStart","fetchData","appliedTemplate","JSON","parse","url","res","get","headers","Authorization","data","flowChart","mapped","map","item","position","size","error","console","selectedNode","handleEditChange","e","name","value","target","prevNodes","handleChildrenChange","s","trim","filter","handleMouseDown","nodeId","stopPropagation","nodeElem","currentTarget","rect","getBoundingClientRect","clientX","left","clientY","top","handleMouseMove","draggedNode","containerRect","current","newX","newY","deltaX","deltaY","dx","dy","Math","max","handleMouseUp","newContainerId","center","forEach","allowed","includes","newChildren","childId","push","handleSelectNode","handleResizeMouseDown","handleDeleteNode","handleAddNewNode","newNode","Date","now","link","extras","prev","handleSave","put","alert","handleDownloadFlowchart","templateName","prompt","exportData","dataStr","encodeURIComponent","stringify","a","document","createElement","href","download","body","appendChild","click","remove","handleUploadFlowchart","file","files","reader","FileReader","onload","event","json","result","readAsText","marginBottom","onClick","marginLeft","accept","onChange","ref","onMouseMove","onMouseUp","zIndex","boxSizing","cursor","onMouseDown","right","bottom","join","arr","_c","$RefreshReg$"],"sources":["/Users/chenguanyu/Desktop/yuniver_CRUD/client/src/pages/CustomFlowChartEditor.jsx"],"sourcesContent":["// src/pages/CustomFlowChartEditor.jsx\nimport React, { useState, useEffect, useRef } from 'react';\nimport axios from 'axios';\nimport { useParams } from 'react-router-dom';\n\n// 預設尺寸與手把大小\nconst NODE_WIDTH_DEFAULT = 140;\nconst NODE_HEIGHT_DEFAULT = 80;\nconst RESIZE_HANDLE_SIZE = 8;\n\n// 定義允許的父節點與子節點類型\nconst allowedChildren = {\n  phase: [\"task\"],\n  task: [\"subFlow\", \"iterative\", \"note\", \"extra\"],\n};\n\n// 根據節點狀態設定背景顏色（預設）\nconst getStatusColor = (node) => {\n  const statusColors = {\n    \"已完成\": \"#d4edda\",\n    \"進行中\": \"#cce5ff\",\n    \"規劃中\": \"#fff3cd\",\n    \"未開始\": \"#e2e3e5\",\n    \"自訂\": \"#f8d7da\"\n  };\n  if (node.type === \"phase\" || node.type === \"task\") {\n    return statusColors[node.status] || statusColors[\"未開始\"];\n  }\n  return \"#fff\";\n};\n\n// 根據形狀設定額外 CSS\nconst getShapeStyle = (shape) => {\n  switch (shape) {\n    case 'ellipse':\n      return { borderRadius: \"50px\" };\n    case 'parallelogram':\n      return { transform: \"skew(-20deg)\" };\n    case 'diamond':\n      return { transform: \"rotate(45deg)\" };\n    case 'rectangle':\n    default:\n      return {};\n  }\n};\n\n// 根據 type 渲染節點內容與樣式\nconst renderNodeContent = (node) => {\n  const commonStyle = { padding: \"4px\", textAlign: \"center\", overflow: \"hidden\", width: \"100%\", height: \"100%\" };\n  const statusText = (node.type === \"phase\" || node.type === \"task\")\n    ? `Status: ${node.status}${node.status === \"自訂\" && node.customStatus ? ` (${node.customStatus})` : \"\"}`\n    : \"\";\n  switch (node.type) {\n    case \"phase\":\n      return (\n        <div style={{ ...commonStyle }}>\n          <div style={{ fontWeight: \"bold\", fontSize: \"14px\" }}>{node.label}</div>\n          <div style={{ fontSize: \"12px\" }}>{node.description}</div>\n          <div style={{ fontSize: \"10px\", marginTop: \"4px\" }}>{statusText}</div>\n        </div>\n      );\n    case \"task\":\n      return (\n        <div style={{ ...commonStyle }}>\n          <div style={{ fontWeight: \"bold\", fontSize: \"14px\" }}>{node.label}</div>\n          {node.important && <div style={{ color: \"red\", fontSize: \"10px\" }}>Important</div>}\n          <div style={{ fontSize: \"12px\" }}>{node.description}</div>\n          <div style={{ fontSize: \"10px\", marginTop: \"4px\" }}>{statusText}</div>\n        </div>\n      );\n    case \"subFlow\":\n      return (\n        <div style={{ ...commonStyle, border: \"2px solid gray\", backgroundColor: \"#f0f0f0\" }}>\n          <div style={{ fontWeight: \"bold\", fontSize: \"13px\" }}>{node.label}</div>\n          <div style={{ fontSize: \"11px\" }}>{node.description}</div>\n        </div>\n      );\n    case \"iterative\":\n      return (\n        <div style={{ ...commonStyle, border: \"2px dotted green\", backgroundColor: \"#e8ffe8\" }}>\n          <div style={{ fontWeight: \"bold\", fontSize: \"14px\" }}>{node.label} 🔄</div>\n          <div style={{ fontSize: \"12px\" }}>{node.description}</div>\n        </div>\n      );\n    case \"note\":\n      return (\n        <div style={{ ...commonStyle, border: \"1px solid orange\", backgroundColor: \"#fff7d6\" }}>\n          <div style={{ fontStyle: \"italic\", fontSize: \"12px\" }}>{node.text || node.label}</div>\n          <div style={{ fontSize: \"10px\" }}>{node.description}</div>\n        </div>\n      );\n    case \"extra\":\n      return (\n        <div style={{ ...commonStyle, fontSize:\"10px\", padding: \"2px\" }}>\n          • {node.content}\n        </div>\n      );\n    default:\n      return (\n        <div style={{ ...commonStyle, border: \"1px solid black\" }}>\n          {node.label || \"No Label\"}\n        </div>\n      );\n  }\n};\n\n// 輔助函式：判斷是否為拖曳節點的後代（根據 containerId 遞迴檢查）\nconst isDescendant = (draggedId, node, allNodes) => {\n  if (node.containerId === draggedId) return true;\n  if (!node.containerId) return false;\n  const parent = allNodes.find(n => n.id === node.containerId);\n  if (!parent) return false;\n  return isDescendant(draggedId, parent, allNodes);\n};\n\nconst CustomFlowChartEditor = () => {\n  // 只解構一次 useParams\n  const { id } = useParams();\n  // 若 id 前綴為 \"template_\" 則視為模板模式\n  const isTemplateMode = id.startsWith(\"template_\");\n  const realId = isTemplateMode ? id.split(\"_\")[1] : id;\n\n  const token = localStorage.getItem('token');\n  // 根據模式選擇 API 路徑\n  const API_URL = process.env.REACT_APP_API_URL || 'http://localhost:5001/api';\n  const containerRef = useRef(null);\n\n  // 節點資料，每個節點包含：id, type, label, description, link, extras, children, containerId, position, size, status, customStatus, shape\n  const [nodes, setNodes] = useState([]);\n  const [selectedNodeId, setSelectedNodeId] = useState(null);\n  const [draggingNodeId, setDraggingNodeId] = useState(null);\n  const [resizingNodeId, setResizingNodeId] = useState(null);\n  const [dragOffset, setDragOffset] = useState({ x: 0, y: 0 });\n  const [resizeStart, setResizeStart] = useState({ x: 0, y: 0, width: 0, height: 0 });\n\n  // 讀取流程圖資料，依模式選擇 API\n  useEffect(() => {\n    const fetchData = async () => {\n      if (realId === \"new\") {\n        const appliedTemplate = localStorage.getItem(\"appliedTemplate\");\n        if (appliedTemplate) {\n          setNodes(JSON.parse(appliedTemplate));\n        } else {\n          setNodes([]);\n        }\n        return;\n      }\n      try {\n        const url = isTemplateMode\n          ? `${API_URL}/templates/${realId}`\n          : `${API_URL}/projects/${realId}/flowchart`;\n        const res = await axios.get(url, {\n          headers: { Authorization: `Bearer ${token}` },\n        });\n        const data = isTemplateMode ? (res.data.flowChart || []) : (res.data || []);\n        const mapped = data.map(item => ({\n          ...item,\n          position: item.position || { x: 50, y: 50 },\n          size: item.size || { width: NODE_WIDTH_DEFAULT, height: NODE_HEIGHT_DEFAULT },\n          containerId: item.containerId || null,\n          children: item.children || [],\n          status: (item.type === \"phase\" || item.type === \"task\") ? (item.status || \"未開始\") : item.status,\n          shape: (item.type === \"phase\" || item.type === \"task\") ? (item.shape || \"rectangle\") : item.shape\n        }));\n        setNodes(mapped);\n      } catch (error) {\n        console.error(\"Failed to load flowchart:\", error);\n      }\n    };\n    fetchData();\n  }, [realId, isTemplateMode, API_URL, token]);\n\n  const selectedNode = nodes.find(n => n.id === selectedNodeId);\n\n  // 更新選中節點屬性\n  const handleEditChange = (e) => {\n    if (!selectedNodeId) return;\n    const { name, value } = e.target;\n    setNodes(prevNodes =>\n      prevNodes.map(n =>\n        n.id === selectedNodeId ? { ...n, [name]: value } : n\n      )\n    );\n  };\n\n  // 處理 children 欄位（逗號分隔轉陣列）\n  const handleChildrenChange = (e) => {\n    if (!selectedNodeId) return;\n    const children = e.target.value.split(\",\").map(s => s.trim()).filter(s => s);\n    setNodes(prevNodes =>\n      prevNodes.map(n =>\n        n.id === selectedNodeId ? { ...n, children } : n\n      )\n    );\n  };\n\n  // 拖曳開始\n  const handleMouseDown = (e, nodeId) => {\n    e.stopPropagation();\n    const nodeElem = e.currentTarget;\n    const rect = nodeElem.getBoundingClientRect();\n    setDraggingNodeId(nodeId);\n    setDragOffset({ x: e.clientX - rect.left, y: e.clientY - rect.top });\n  };\n\n  // 拖曳移動：更新拖曳節點及其所有後代（遞迴更新）\n  const handleMouseMove = (e) => {\n    if (draggingNodeId) {\n      setNodes(prevNodes => {\n        const draggedNode = prevNodes.find(n => n.id === draggingNodeId);\n        if (!draggedNode) return prevNodes;\n        const containerRect = containerRef.current.getBoundingClientRect();\n        const newX = e.clientX - containerRect.left - dragOffset.x;\n        const newY = e.clientY - containerRect.top - dragOffset.y;\n        const deltaX = newX - draggedNode.position.x;\n        const deltaY = newY - draggedNode.position.y;\n        return prevNodes.map(n => {\n          if (n.id === draggingNodeId || isDescendant(draggingNodeId, n, prevNodes)) {\n            return {\n              ...n,\n              position: {\n                x: n.position.x + deltaX,\n                y: n.position.y + deltaY\n              }\n            };\n          }\n          return n;\n        });\n      });\n    }\n    if (resizingNodeId) {\n      const containerRect = containerRef.current.getBoundingClientRect();\n      const dx = e.clientX - containerRect.left - resizeStart.x;\n      const dy = e.clientY - containerRect.top - resizeStart.y;\n      setNodes(prevNodes =>\n        prevNodes.map(n => {\n          if (n.id === resizingNodeId) {\n            return {\n              ...n,\n              size: {\n                width: Math.max(40, resizeStart.width + dx),\n                height: Math.max(30, resizeStart.height + dy)\n              }\n            };\n          }\n          return n;\n        })\n      );\n    }\n  };\n\n  // 拖曳/縮放結束：檢查是否落入 Phase 或 Task 節點內，更新 containerId 與父節點 children\n  const handleMouseUp = () => {\n    if (draggingNodeId) {\n      setNodes(prevNodes => {\n        const draggedNode = prevNodes.find(n => n.id === draggingNodeId);\n        let newContainerId = null;\n        if (draggedNode) {\n          const center = {\n            x: draggedNode.position.x + draggedNode.size.width / 2,\n            y: draggedNode.position.y + draggedNode.size.height / 2\n          };\n          prevNodes.forEach(parent => {\n            if (parent.id !== draggedNode.id && (parent.type === \"phase\" || parent.type === \"task\")) {\n              if (\n                center.x >= parent.position.x &&\n                center.x <= parent.position.x + parent.size.width &&\n                center.y >= parent.position.y &&\n                center.y <= parent.position.y + parent.size.height\n              ) {\n                const allowed = allowedChildren[parent.type] || [];\n                if (allowed.includes(draggedNode.type)) {\n                  newContainerId = parent.id;\n                }\n              }\n            }\n          });\n        }\n        return prevNodes.map(n => {\n          if (n.id === draggingNodeId) {\n            return { ...n, containerId: newContainerId };\n          }\n          if (n.type === \"phase\" || n.type === \"task\") {\n            let newChildren = n.children ? [...n.children] : [];\n            newChildren = newChildren.filter(childId => childId !== draggingNodeId);\n            if (n.id === newContainerId) {\n              newChildren.push(draggingNodeId);\n            }\n            return { ...n, children: newChildren };\n          }\n          return n;\n        });\n      });\n      setDraggingNodeId(null);\n    }\n    if (resizingNodeId) {\n      setResizingNodeId(null);\n    }\n  };\n\n  // 節點選取\n  const handleSelectNode = (e, nodeId) => {\n    e.stopPropagation();\n    setSelectedNodeId(nodeId);\n  };\n\n  // 開始縮放（點擊右下角手把）\n  const handleResizeMouseDown = (e, nodeId) => {\n    e.stopPropagation();\n    if (!selectedNode) return;\n    const containerRect = containerRef.current.getBoundingClientRect();\n    setResizingNodeId(nodeId);\n    setResizeStart({\n      x: e.clientX - containerRect.left,\n      y: e.clientY - containerRect.top,\n      width: selectedNode.size.width,\n      height: selectedNode.size.height\n    });\n  };\n\n  // 刪除節點\n  const handleDeleteNode = () => {\n    if (!selectedNodeId) return;\n    setNodes(prevNodes =>\n      prevNodes.filter(n => n.id !== selectedNodeId)\n        .map(n => n.containerId === selectedNodeId ? { ...n, containerId: null } : n)\n    );\n    setSelectedNodeId(null);\n  };\n\n  // 新增節點：根據 type 新增，對於 phase 與 task 預設 shape 為 rectangle\n  const handleAddNewNode = (type = \"task\") => {\n    const newNode = {\n      id: `${Date.now()}`,\n      type,\n      label: type === \"phase\" ? \"New Phase\" : \"New Node\",\n      description: \"\",\n      link: \"\",\n      extras: [],\n      children: [],\n      containerId: null,\n      position: { x: 50, y: 50 },\n      size: { width: NODE_WIDTH_DEFAULT, height: NODE_HEIGHT_DEFAULT },\n      status: (type === \"phase\" || type === \"task\") ? \"未開始\" : \"\",\n      shape: (type === \"phase\" || type === \"task\") ? \"rectangle\" : \"\"\n    };\n    setNodes(prev => [...prev, newNode]);\n  };\n\n  // 儲存流程圖，根據模式選擇 API 路徑\n  const handleSave = async () => {\n    try {\n      const url = isTemplateMode\n        ? `${API_URL}/templates/${realId}`\n        : `${API_URL}/projects/${realId}/flowchart`;\n      await axios.put(url,\n        { flowChart: nodes },\n        { headers: { Authorization: `Bearer ${token}` } }\n      );\n      alert(\"Flowchart saved successfully!\");\n    } catch (error) {\n      console.error(\"Failed to save flowchart:\", error);\n      alert(\"Save failed.\");\n    }\n  };\n\n  // 下載流程圖 JSON，附加 name 欄位\n  const handleDownloadFlowchart = () => {\n    const templateName = prompt(\"請輸入模板名稱：\", `Flowchart Template ${realId}`);\n    const exportData = {\n      name: templateName,\n      flowChart: nodes\n    };\n    const dataStr = \"data:text/json;charset=utf-8,\" + encodeURIComponent(JSON.stringify(exportData, null, 2));\n    const a = document.createElement(\"a\");\n    a.href = dataStr;\n    a.download = `${templateName || \"flowchart_template\"}.json`;\n    document.body.appendChild(a);\n    a.click();\n    a.remove();\n  };\n\n  // 上傳流程圖 JSON 檔案並套用\n  const handleUploadFlowchart = (e) => {\n    const file = e.target.files[0];\n    if (!file) return;\n    const reader = new FileReader();\n    reader.onload = (event) => {\n      try {\n        const json = JSON.parse(event.target.result);\n        if (json.flowChart) {\n          setNodes(json.flowChart);\n        } else {\n          setNodes(json);\n        }\n      } catch (error) {\n        alert(\"Invalid JSON file\");\n      }\n    };\n    reader.readAsText(file);\n  };\n\n  return (\n    <div>\n      <h2>Custom Flow Chart Editor {isTemplateMode ? \"(Template Mode)\" : \"\"}</h2>\n      <div style={{ marginBottom: \"10px\" }}>\n        <button onClick={() => handleAddNewNode(\"task\")}>Add Task</button>\n        <button onClick={() => handleAddNewNode(\"phase\")} style={{ marginLeft: \"10px\" }}>Add Phase</button>\n        <button onClick={handleSave} style={{ marginLeft: \"10px\" }}>Save Flow Chart</button>\n        <button onClick={handleDownloadFlowchart} style={{ marginLeft: \"10px\" }}>Download Flowchart</button>\n        <label style={{ marginLeft: \"10px\" }}>\n          Import Flowchart:\n          <input type=\"file\" accept=\".json\" onChange={handleUploadFlowchart} style={{ marginLeft: \"5px\" }} />\n        </label>\n      </div>\n      <div\n        ref={containerRef}\n        style={{ position: \"relative\", width: \"100%\", height: \"600px\", border: \"1px solid #ccc\", backgroundColor: \"#fafafa\" }}\n        onMouseMove={handleMouseMove}\n        onMouseUp={handleMouseUp}\n      >\n        {nodes.map(node => {\n          const zIndex = node.containerId ? 10 : (node.type === \"phase\" || node.type === \"task\" ? 5 : 1);\n          return (\n            <div\n              key={node.id}\n              style={{\n                position: \"absolute\",\n                left: node.position.x,\n                top: node.position.y,\n                width: node.size.width,\n                height: node.size.height,\n                border: selectedNodeId === node.id ? \"2px solid red\" : \"1px solid #333\",\n                boxSizing: \"border-box\",\n                backgroundColor: (node.type === \"phase\" || node.type === \"task\") ? getStatusColor(node) : \"#fff\",\n                cursor: \"move\",\n                zIndex,\n                ...getShapeStyle(node.shape)\n              }}\n              onMouseDown={(e) => handleMouseDown(e, node.id)}\n              onClick={(e) => handleSelectNode(e, node.id)}\n            >\n              {renderNodeContent(node)}\n              {selectedNodeId === node.id && (\n                <div\n                  style={{\n                    position: \"absolute\",\n                    right: 0,\n                    bottom: 0,\n                    width: RESIZE_HANDLE_SIZE,\n                    height: RESIZE_HANDLE_SIZE,\n                    backgroundColor: \"gray\",\n                    cursor: \"se-resize\"\n                  }}\n                  onMouseDown={(e) => handleResizeMouseDown(e, node.id)}\n                />\n              )}\n            </div>\n          );\n        })}\n      </div>\n      {selectedNode && (\n        <div style={{ marginTop: \"20px\", border: \"1px solid #ccc\", padding: \"10px\" }}>\n          <h3>Edit Node Properties</h3>\n          <div>\n            <label>Type:</label>\n            <select name=\"type\" value={selectedNode.type} onChange={handleEditChange}>\n              <option value=\"phase\">phase</option>\n              <option value=\"task\">task</option>\n              <option value=\"subFlow\">subFlow</option>\n              <option value=\"iterative\">iterative</option>\n              <option value=\"note\">note</option>\n              <option value=\"extra\">extra</option>\n            </select>\n          </div>\n          <div>\n            <label>Label:</label>\n            <input name=\"label\" value={selectedNode.label} onChange={handleEditChange} />\n          </div>\n          <div>\n            <label>Description:</label>\n            <textarea name=\"description\" value={selectedNode.description} onChange={handleEditChange} />\n          </div>\n          <div>\n            <label>Link:</label>\n            <input name=\"link\" value={selectedNode.link} onChange={handleEditChange} />\n          </div>\n          {(selectedNode.type === \"phase\" || selectedNode.type === \"task\") && (\n            <div>\n              <label>Status:</label>\n              <select name=\"status\" value={selectedNode.status} onChange={handleEditChange}>\n                <option value=\"未開始\">未開始</option>\n                <option value=\"規劃中\">規劃中</option>\n                <option value=\"進行中\">進行中</option>\n                <option value=\"已完成\">已完成</option>\n                <option value=\"自訂\">自訂</option>\n              </select>\n              {selectedNode.status === \"自訂\" && (\n                <div>\n                  <label>Custom Status:</label>\n                  <input name=\"customStatus\" value={selectedNode.customStatus || \"\"} onChange={handleEditChange} />\n                </div>\n              )}\n              <div>\n                <label>Shape:</label>\n                <select name=\"shape\" value={selectedNode.shape} onChange={handleEditChange}>\n                  <option value=\"rectangle\">矩形</option>\n                  <option value=\"ellipse\">橢圓 / 藥丸</option>\n                  <option value=\"parallelogram\">平行四邊形</option>\n                  <option value=\"diamond\">菱形</option>\n                </select>\n              </div>\n            </div>\n          )}\n          <div>\n            <label>Children (comma-separated IDs):</label>\n            <input\n              value={(selectedNode.children || []).join(\",\")}\n              onChange={handleChildrenChange}\n            />\n          </div>\n          <div>\n            <label>Extras (comma-separated):</label>\n            <input\n              name=\"extras\"\n              value={(selectedNode.extras || []).join(\",\")}\n              onChange={(e) => {\n                const arr = e.target.value.split(\",\").map(s => s.trim()).filter(s => s);\n                handleEditChange({ target: { name: \"extras\", value: arr } });\n              }}\n            />\n          </div>\n          <div style={{ marginTop: \"10px\" }}>\n            <button onClick={handleDeleteNode}>Delete Node</button>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default CustomFlowChartEditor;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}